define("local_xlate/autotranslate",["core/ajax","core/notification"],(function(Ajax,notification){return{init:function(config){var courseButton=document.getElementById("local_xlate_autotranslate_course");courseButton&&courseButton&&courseButton.addEventListener("click",(function(){var courseid=0;if("undefined"!=typeof window&&void 0!==window.XLATE_COURSEID?courseid=window.XLATE_COURSEID||0:config&&config.courseid&&(courseid=config.courseid||0),courseid){var targets=[],checked=document.querySelectorAll('input[name="local_xlate_target[]"]:checked');if(checked&&checked.length)for(var ci=0;ci<checked.length;ci++){var val=checked[ci].value||"";val&&targets.push(val.toString().trim())}else{var targetEl=document.getElementById("local_xlate_target");if(targetEl)if(targetEl.multiple)for(var si=0;si<targetEl.options.length;si++)targetEl.options[si].selected&&targets.push((targetEl.options[si].value||"").toString().trim());else{var v=targetEl.value||"";v&&targets.push(v.toString().trim())}else{var targetcfg=config&&config.defaulttarget?config.defaulttarget:"";targets=Array.isArray(targetcfg)?targetcfg:[targetcfg]}}if(targets.length){var options={batchsize:config&&config.batchsize?config.batchsize:50,targetlang:targets,sourcelang:config&&config.sourcelang?config.sourcelang:"en"};Ajax.call([{methodname:"local_xlate_autotranslate_course_enqueue",args:{courseid:courseid,options:options}}])[0].then((function(res){res&&res.success?(notification.alert("Course autotranslate job queued. Job id: "+(res.jobid||"n/a")),function(jobid){if(!jobid)return;var statusId="local_xlate_course_autotranslate_status",statusEl=document.getElementById(statusId);statusEl||((statusEl=document.createElement("div")).id=statusId,statusEl.style.position="fixed",statusEl.style.left="16px",statusEl.style.bottom="16px",statusEl.style.zIndex=1050,statusEl.style.maxWidth="420px",statusEl.style.background="white",statusEl.style.border="1px solid #ccc",statusEl.style.boxShadow="0 2px 6px rgba(0,0,0,0.1)",statusEl.style.padding="12px",statusEl.style.borderRadius="6px",document.body.appendChild(statusEl));var tries=0,maxTries=120,handle=setInterval((function(){tries+=1,Ajax.call([{methodname:"local_xlate_autotranslate_course_progress",args:{jobid:jobid}}])[0].then((function(res){if(res&&res.success&&res.job){var job=res.job;statusEl.innerHTML="<strong>Course Autotranslate</strong><br/>Status: "+job.status+"<br/>Processed: "+job.processed+" / "+job.total+'<br/><div style="margin-top:8px;text-align:right"><button id="local_xlate_course_status_close" class="btn btn-sm btn-secondary">Close</button></div>';var closeBtn=document.getElementById("local_xlate_course_status_close");closeBtn&&closeBtn.addEventListener("click",(function(){statusEl&&statusEl.parentNode&&statusEl.parentNode.removeChild(statusEl)})),"complete"===job.status||job.processed>=job.total?(clearInterval(handle),notification.alert("Course autotranslate complete: "+job.processed+" / "+job.total)):tries>=maxTries&&(clearInterval(handle),notification.alert("Course autotranslate polling timed out: "+job.processed+" / "+job.total))}})).catch((function(){}))}),5e3)}(res.jobid)):notification.alert("Failed to enqueue course autotranslate job.")})).catch((function(err){notification.alert("Error enqueuing course job: "+(err&&err.message?err.message:String(err)))}))}else notification.alert("No target languages selected for course autotranslate.")}else notification.alert("Please navigate to this page with a valid course filter to autotranslate the course.")}))}}}));

//# sourceMappingURL=autotranslate.min.js.map