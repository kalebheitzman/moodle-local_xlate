define("local_xlate/autotranslate",["core/ajax","core/notification"],(function(Ajax,notification){return{init:function(config){var courseButton=document.getElementById("local_xlate_autotranslate_course");if(config&&config.currentjobid&&!document.getElementById("local_xlate_course_progress"))try{var parent=document.getElementById("region-main")||document.body,wrapper=document.createElement("div");wrapper.id="local_xlate_course_progress_wrapper",wrapper.style.margin="12px 0",wrapper.innerHTML='<div id="local_xlate_course_progress" style="display:block;"><div style="font-size:90%; margin-bottom:6px"><span id="local_xlate_course_job_owner" style="font-weight:600"></span><span id="local_xlate_course_job_status" style="margin-left:8px; color:#666"></span><span id="local_xlate_course_job_langs" style="float:right; font-size:90%"></span></div><div class="progress" role="progressbar" aria-label="Autotranslate progress"><div id="local_xlate_course_progress_bar" class="progress-bar progress-bar-striped progress-bar-animated bg-info" style="width:0%" aria-valuemin="0" aria-valuemax="100">0%</div></div><div id="local_xlate_course_progress_text" style="margin-top:6px; font-size:90%">0 / 0</div></div>',parent.insertBefore(wrapper,parent.firstChild)}catch(e){}if(courseButton&&courseButton.addEventListener("click",(function(){var courseid=0;if("undefined"!=typeof window&&void 0!==window.XLATE_COURSEID?courseid=window.XLATE_COURSEID||0:config&&config.courseid&&(courseid=config.courseid||0),courseid){var selectedTargets=[],targetInputs=document.querySelectorAll('#local_xlate_target_container input[type="checkbox"]');if(targetInputs&&targetInputs.length&&(selectedTargets=Array.prototype.filter.call(targetInputs,(function(input){return!!input.checked})).map((function(input){return input.value}))),selectedTargets.length){var options={batchsize:config&&config.batchsize?config.batchsize:50,targetlang:selectedTargets};Ajax.call([{methodname:"local_xlate_autotranslate_course_enqueue",args:{courseid:courseid,options:options}}])[0].then((function(res){res&&res.success?(notification.alert("Course autotranslate job queued. Job id: "+(res.jobid||"n/a")),startCoursePolling(res.jobid)):notification.alert("Failed to enqueue course autotranslate job.")})).catch((function(err){var msg="Error enqueuing course job";err&&err.message?msg+=": "+err.message:err&&err.error&&(msg+=": "+err.error),-1===msg.toLowerCase().indexOf("language")&&-1===msg.toLowerCase().indexOf("configuration")||(msg+="\n\nPlease configure source and target languages in the course settings (Xlate section)."),notification.alert(msg)}))}else notification.alert("Select at least one target language before enqueuing autotranslation.")}else notification.alert("Please navigate to this page with a valid course filter to autotranslate the course.")})),config&&config.currentjobid)try{startCoursePolling(config.currentjobid)}catch(e){}function startCoursePolling(jobid){if(jobid){var container=document.getElementById("local_xlate_course_progress"),bar=document.getElementById("local_xlate_course_progress_bar"),text=document.getElementById("local_xlate_course_progress_text");if(container&&bar&&text){if(container.style.display="block",config){var ownerEl=document.getElementById("local_xlate_course_job_owner"),statusEl=document.getElementById("local_xlate_course_job_status");ownerEl&&config.currentjobowner&&(ownerEl.textContent="Job by "+config.currentjobowner),statusEl&&config.currentjobstatus&&(statusEl.textContent="("+config.currentjobstatus+")");var langsEl=document.getElementById("local_xlate_course_job_langs");if(langsEl){var parts=[];config.currentjobsourcelang&&parts.push(config.currentjobsourcelang+" →"),config.currentjobtargetlang&&(Array.isArray(config.currentjobtargetlang)?parts.push(config.currentjobtargetlang.join(", ")):parts.push(config.currentjobtargetlang)),parts.length&&(langsEl.textContent=parts.join(" "))}if(void 0!==config.currentjobprocessed&&void 0!==config.currentjobtotal){text.textContent=config.currentjobprocessed+" / "+config.currentjobtotal;var pct=config.currentjobtotal>0?Math.round(config.currentjobprocessed/config.currentjobtotal*100):0;bar.style.width=pct+"%",bar.setAttribute("aria-valuenow",pct),bar.textContent=pct+"%"}}var tries=0,handle=setInterval((function(){tries+=1,Ajax.call([{methodname:"local_xlate_autotranslate_course_progress",args:{jobid:jobid}}])[0].then((function(res){if(res&&res.success&&res.job){var job=res.job,total=job.total||0,processed=job.processed||0,percent=total>0?Math.round(processed/total*100):0;bar.style.width=percent+"%",bar.setAttribute("aria-valuenow",percent),bar.textContent=percent+"%",text.textContent=processed+" / "+total,"complete"===job.status||processed>=total?(clearInterval(handle),bar.style.width="100%",bar.setAttribute("aria-valuenow",100),bar.textContent="100%",text.textContent=(processed||total)+" / "+total+" — complete",notification.alert("Course autotranslate complete: "+processed+" / "+total)):tries>=120&&(clearInterval(handle),notification.alert("Course autotranslate polling timed out: "+processed+" / "+total))}})).catch((function(){}))}),5e3)}}}}}}));

//# sourceMappingURL=autotranslate.min.js.map