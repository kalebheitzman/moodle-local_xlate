define("local_xlate/capture",["jquery","core/ajax","core/notification","core/modal_factory","core/modal_events"],(function($,Ajax,Notification,ModalFactory,ModalEvents){var captureMode=!1,captureOverlay=null;function isTranslatableElement(element){var $el=$(element),tagName=element.tagName.toLowerCase();if($el.attr("data-xlate")||$el.attr("data-xlate-placeholder")||$el.attr("data-xlate-title")||$el.attr("data-xlate-alt"))return!1;if($el.attr("data-xlate-ignore")||$el.closest("[data-xlate-ignore]").length)return!1;if(["script","style","meta","link","noscript"].includes(tagName))return!1;var hasText=element.textContent&&element.textContent.trim().length>0,hasPlaceholder=$el.attr("placeholder")&&$el.attr("placeholder").trim().length>0,hasTitle=$el.attr("title")&&$el.attr("title").trim().length>0,hasAlt=$el.attr("alt")&&$el.attr("alt").trim().length>0;return hasText||hasPlaceholder||hasTitle||hasAlt}function showKeyAssignmentModal(element){var $el=$(element),suggestedKey=function(element){var $el=$(element),text=element.textContent?element.textContent.trim():"",placeholder=$el.attr("placeholder")||"",title=$el.attr("title")||"",alt=$el.attr("alt")||"",key=(text||placeholder||title||alt).replace(/[^\w\s]/g,"").replace(/\s+/g,".").replace(/\.+/g,".").replace(/^\.+|\.+$/g,"");key.length>50&&(key=key.substring(0,50).replace(/\.[^.]*$/,""));var tagName=element.tagName.toLowerCase();return placeholder?key="Input."+key:["h1","h2","h3","h4","h5","h6"].includes(tagName)?key="Heading."+key:"button"===tagName?key="Button."+key:"a"===tagName?key="Link."+key:alt&&(key="Image."+key),key||"Untitled"}(element),modalBody=function(suggestedKey,textContent,placeholder,title,alt){var modalBody='\n            <div class="form-group">\n                <label for="xlate-key">Translation Key:</label>\n                <input type="text" id="xlate-key" class="form-control" value="'.concat(suggestedKey,'" required>\n                <small class="form-text text-muted">Use dot notation (e.g., Dashboard.Title, Button.Save)</small>\n            </div>\n            <div class="form-group">\n                <label for="xlate-component">Component:</label>\n                <input type="text" id="xlate-component" class="form-control" value="core" required>\n                <small class="form-text text-muted">Component identifier (core, mod_forum, theme_boost, etc.)</small>\n            </div>\n        ');textContent&&(modalBody+='\n                <div class="form-group">\n                    <label>Text Content:</label>\n                    <div class="form-control-static bg-light p-2 border rounded">'.concat(textContent,'</div>\n                    <input type="hidden" id="xlate-text-content" value="').concat(textContent.replace(/"/g,"&quot;"),'">\n                </div>\n            '));placeholder&&(modalBody+=buildAttributeField("placeholder",suggestedKey+".Placeholder",placeholder));title&&(modalBody+=buildAttributeField("title",suggestedKey+".Title",title));alt&&(modalBody+=buildAttributeField("alt",suggestedKey+".Alt",alt));return modalBody}(suggestedKey,element.textContent?element.textContent.trim():"",$el.attr("placeholder")||"",$el.attr("title")||"",$el.attr("alt")||"");ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:"Assign Translation Key",body:modalBody,large:!0}).then((function(modal){return modal.show(),modal.getRoot().on(ModalEvents.save,(function(){!function(element,modal){var $modal=modal.getRoot(),key=$modal.find("#xlate-key").val().trim(),component=$modal.find("#xlate-component").val().trim();if(!key||!component)return void Notification.addNotification({message:"Key and component are required",type:"error"});var $el=$(element),ajaxRequests=function($modal,component,key){var ajaxRequests=[],textContent=$modal.find("#xlate-text-content").val();textContent&&ajaxRequests.push({methodname:"local_xlate_save_key",args:{component:component,key:key,source:textContent,lang:M.cfg.language||"en",translation:textContent}});return["placeholder","title","alt"].forEach((function(attr){var attrKey=$modal.find("#xlate-"+attr+"-key").val(),attrContent=$modal.find("#xlate-"+attr+"-content").val();attrKey&&attrContent&&ajaxRequests.push({methodname:"local_xlate_save_key",args:{component:component,key:attrKey,source:attrContent,lang:M.cfg.language||"en",translation:attrContent}})})),ajaxRequests}($modal,component,key);Ajax.call(ajaxRequests).then((function(){return function($el,$modal,key){$modal.find("#xlate-text-content").val()&&$el.attr("data-xlate",key);["placeholder","title","alt"].forEach((function(attr){var attrKey=$modal.find("#xlate-"+attr+"-key").val(),attrContent=$modal.find("#xlate-"+attr+"-content").val();attrKey&&attrContent&&$el.attr("data-xlate-"+attr,attrKey)}))}($el,$modal,key),$el.removeClass("xlate-highlighted"),Notification.addNotification({message:"Translation key(s) saved successfully",type:"success"}),modal.hide(),!0})).catch((function(error){Notification.addNotification({message:"Error saving translation key: "+(error.message||"Unknown error"),type:"error"})}))}(element,modal)})),modal})).catch((function(error){Notification.addNotification({message:"Error showing modal: "+error.message,type:"error"})}))}function buildAttributeField(attr,suggestedKey,content){var capitalizedAttr=attr.charAt(0).toUpperCase()+attr.slice(1);return'\n            <div class="form-group">\n                <label for="xlate-'.concat(attr,'-key">').concat(capitalizedAttr,' Key (optional):</label>\n                <input type="text" id="xlate-').concat(attr,'-key" class="form-control" value="').concat(suggestedKey,'">\n                <div class="form-control-static bg-light p-2 border rounded mt-1">').concat(content,'</div>\n                <input type="hidden" id="xlate-').concat(attr,'-content" value="').concat(content.replace(/"/g,"&quot;"),'">\n            </div>\n        ')}function handleMouseOver(e){if(captureMode){var element=e.target;if(isTranslatableElement(element)){$(".xlate-highlighted").removeClass("xlate-highlighted"),$(".xlate-capture-tooltip").remove(),$(element).addClass("xlate-highlighted");var tooltip=$('<div class="xlate-capture-tooltip">Click to assign translation key</div>');tooltip.css({top:e.pageY+10,left:e.pageX+10}),$("body").append(tooltip)}}}function handleClick(e){if(captureMode){var element=e.target;isTranslatableElement(element)&&(e.preventDefault(),e.stopPropagation(),showKeyAssignmentModal(element))}}function enterCaptureMode(){captureMode||(captureMode=!0,function(){if(!document.getElementById("xlate-capture-css")){var style=document.createElement("style");style.id="xlate-capture-css",style.textContent="\n        .xlate-capture-overlay {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.3);\n            z-index: 10000;\n            pointer-events: none;\n        }\n        .xlate-capture-notice {\n            position: fixed;\n            top: 20px;\n            left: 50%;\n            transform: translateX(-50%);\n            background: #0f6cbf;\n            color: white;\n            padding: 12px 24px;\n            border-radius: 6px;\n            font-size: 14px;\n            z-index: 10001;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n        }\n        .xlate-highlighted {\n            outline: 3px solid #ff6b35 !important;\n            outline-offset: 2px !important;\n            cursor: crosshair !important;\n            position: relative;\n        }\n        .xlate-capture-tooltip {\n            position: absolute;\n            background: #333;\n            color: white;\n            padding: 4px 8px;\n            border-radius: 3px;\n            font-size: 12px;\n            z-index: 10002;\n            pointer-events: none;\n            white-space: nowrap;\n        }\n    ",document.head.appendChild(style)}}(),function(){if(!captureOverlay){captureOverlay=$('<div class="xlate-capture-overlay"></div>');var notice=$('<div class="xlate-capture-notice">Capture Mode Active - Click any text element to assign a translation key (ESC to exit)</div>');$("body").append(captureOverlay).append(notice),$(document).on("keydown.xlate-capture",(function(e){"Escape"===e.key&&exitCaptureMode()}))}}(),$(document).on("mouseover.xlate-capture",handleMouseOver),$(document).on("click.xlate-capture",handleClick),Notification.addNotification({message:"Capture mode activated. Click on text elements to assign translation keys.",type:"info"}))}function exitCaptureMode(){captureMode&&(captureMode=!1,captureOverlay&&(captureOverlay.remove(),$(".xlate-capture-notice").remove(),captureOverlay=null),$(document).off("keydown.xlate-capture"),$(".xlate-highlighted").removeClass("xlate-highlighted"),$(".xlate-capture-tooltip").remove(),$(document).off("mouseover.xlate-capture"),$(document).off("click.xlate-capture"),Notification.addNotification({message:"Capture mode deactivated.",type:"info"}))}return{enter:enterCaptureMode,exit:exitCaptureMode,toggle:function(){captureMode?exitCaptureMode():enterCaptureMode()},isActive:function(){return captureMode}}}));

//# sourceMappingURL=capture.min.js.map