define("local_xlate/edit",[],(function(){var ATTRIBUTE_TYPES=["content","placeholder","title","alt","aria-label"],SELECTOR=ATTRIBUTE_TYPES.map((function(attr){return"[data-xlate-key-"+attr+"]"})).join(","),STATE={config:{enabled:!1,manageUrl:"",courseid:0,strings:{},inlineToggle:!1},active:!1,currentElement:null,currentAttribute:null,attributes:[],ready:!1,hasExternalToggle:!1,toggleRenderer:null},NODES={toggle:null,highlight:null,toolbar:null,callout:null};function merge(base,overrides){var key,result={};for(key in base)Object.prototype.hasOwnProperty.call(base,key)&&("object"!=typeof base[key]||null===base[key]||Array.isArray(base[key])?result[key]=base[key]:result[key]=merge(base[key],{}));for(key in overrides)if(Object.prototype.hasOwnProperty.call(overrides,key)){var val=overrides[key];val&&"object"==typeof val&&!Array.isArray(val)?result[key]=merge(result[key]||{},val):result[key]=val}return result}function attachToggleButton(button){button&&button.addEventListener("click",handleToggleClick)}function handleToggleClick(event){event.preventDefault(),STATE.ready&&STATE.config.enabled&&(STATE.active?deactivateInspector():function(){if(STATE.active)return;STATE.active=!0,document.addEventListener("pointermove",handlePointerMove,!0),document.addEventListener("pointerleave",handlePointerLeave,!0),window.addEventListener("scroll",handleViewportChange,!0),window.addEventListener("resize",handleViewportChange,!0),document.addEventListener("keydown",handleKeydown,!0),document.documentElement.classList.add("xlate-inspector-active"),updateToggleVisuals(),showToast(STATE.config.strings.toggleActive||"Inspector enabled")}())}function deactivateInspector(){STATE.active&&(STATE.active=!1,document.removeEventListener("pointermove",handlePointerMove,!0),document.removeEventListener("pointerleave",handlePointerLeave,!0),window.removeEventListener("scroll",handleViewportChange,!0),window.removeEventListener("resize",handleViewportChange,!0),document.removeEventListener("keydown",handleKeydown,!0),document.documentElement.classList.remove("xlate-inspector-active"),updateToggleVisuals(),clearCurrent())}function updateToggleVisuals(){if(NODES.toggle){var button=NODES.toggle;if(STATE.active?(button.classList.add("is-active"),button.setAttribute("aria-pressed","true")):(button.classList.remove("is-active"),button.setAttribute("aria-pressed","false")),button.classList&&(STATE.ready?button.classList.remove("is-disabled"):button.classList.add("is-disabled")),void 0!==button.disabled&&(button.disabled=!STATE.ready),button.setAttribute("aria-disabled",STATE.ready?"false":"true"),STATE.toggleRenderer)STATE.toggleRenderer(STATE.active);else{var activeText=STATE.config.strings.toggleActive||"Inspector enabled",inactiveText=STATE.config.strings.toggleInactive||"Enable inspector";button.textContent=STATE.active?activeText:inactiveText}}}function handlePointerMove(event){if(STATE.active&&!isOverlayNode(event.target)){var candidate=event.target.closest?event.target.closest(SELECTOR):null;if(candidate)STATE.currentElement!==candidate&&function(element){if(STATE.currentElement=element,STATE.attributes=function(element){for(var attrs=[],i=0;i<ATTRIBUTE_TYPES.length;i++){var attrType=ATTRIBUTE_TYPES[i],keyAttr="data-xlate-key-"+attrType,keyValue=element.getAttribute(keyAttr);if(keyValue){var preview=extractSourcePreview(element,attrType,keyValue);preview||(preview=extractValue(element,attrType)),attrs.push({type:attrType,key:keyValue,preview:preview})}}return attrs}(element),!STATE.attributes.length)return void clearCurrent();STATE.currentAttribute||(STATE.currentAttribute=STATE.attributes[0].type);(function(type){for(var i=0;i<STATE.attributes.length;i++)if(STATE.attributes[i].type===type)return!0;return!1})(STATE.currentAttribute)||(STATE.currentAttribute=STATE.attributes[0].type);refreshOverlay()}(candidate);else{if(function(event){if(!STATE.currentElement)return!1;if("number"!=typeof event.clientX||"number"!=typeof event.clientY)return!1;var rect=STATE.currentElement.getBoundingClientRect();if(!rect)return!1;var x=event.clientX,y=event.clientY;return x>=rect.left-24&&x<=rect.right+24&&y>=rect.top-24&&y<=rect.bottom+24}(event))return;clearCurrent()}}}function handlePointerLeave(event){STATE.active&&(isOverlayNode(event.relatedTarget)||event.relatedTarget||clearCurrent())}function handleViewportChange(){STATE.active&&STATE.currentElement&&refreshOverlay()}function handleKeydown(event){STATE.active&&("Escape"!==event.key&&"Esc"!==event.key||(event.preventDefault(),deactivateInspector()))}function isOverlayNode(node){return!!node&&(node===NODES.toolbar||node===NODES.callout||node===NODES.toggle||!!node.closest&&!!(node.closest(".xlate-inspector-toolbar")||node.closest(".xlate-inspector-callout")||node.closest(".xlate-inspector-toggle")||node.closest("[data-xlate-inspector-toggle]")))}function extractValue(element,attrType){return"content"===attrType?(element.innerText||element.textContent||"").trim():(element.getAttribute(attrType)||"").trim()}function extractSourcePreview(element,attrType,keyValue){var attrName="data-xlate-original-"+attrType,value="";return element&&element.hasAttribute(attrName)&&(value=element.getAttribute(attrName)||""),!value&&keyValue&&window.__XLATE__&&window.__XLATE__.sourceStrings&&Object.prototype.hasOwnProperty.call(window.__XLATE__.sourceStrings,keyValue)&&(value=window.__XLATE__.sourceStrings[keyValue]||""),value?("content"===attrType&&(value=function(value){if(!value||-1===value.indexOf("<"))return value||"";var div=document.createElement("div");return div.innerHTML=value,(div.textContent||div.innerText||"").trim()}(value)),value=value.trim()):""}function refreshOverlay(){if(STATE.currentElement){var rect=STATE.currentElement.getBoundingClientRect(),highlight=ensureNode("highlight");highlight.style.left=rect.left+"px",highlight.style.top=rect.top+"px",highlight.style.width=Math.max(rect.width,1)+"px",highlight.style.height=Math.max(rect.height,1)+"px",highlight.classList.add("is-visible"),function(rect){var toolbar=ensureNode("toolbar");toolbar.innerHTML="";var attributes=document.createElement("div");attributes.className="xlate-inspector-attributes",STATE.attributes.forEach((function(attr){var btn=document.createElement("button");btn.type="button",btn.className="xlate-inspector-attr",attr.type===STATE.currentAttribute&&btn.classList.add("is-active"),btn.textContent=getAttributeLabel(attr.type),btn.dataset.xlateAttr=attr.type,btn.addEventListener("click",(function(event){event.preventDefault(),STATE.currentAttribute=attr.type,refreshOverlay()})),attributes.appendChild(btn)})),toolbar.appendChild(attributes);var meta=document.createElement("div");meta.className="xlate-inspector-meta";var current=getCurrentAttribute(),keyLabel=document.createElement("span");keyLabel.className="xlate-inspector-key",keyLabel.textContent=current?current.key:STATE.config.strings.noKey||"",meta.appendChild(keyLabel);var copyBtn=document.createElement("button");copyBtn.type="button",copyBtn.className="xlate-inspector-action",copyBtn.textContent=STATE.config.strings.copyKey||"Copy key",copyBtn.addEventListener("click",(function(event){event.preventDefault(),current&&current.key&&function(value){if(!value)return;if(navigator.clipboard&&navigator.clipboard.writeText)return void navigator.clipboard.writeText(value).then((function(){showToast(STATE.config.strings.copied||"Key copied")})).catch((function(){fallbackCopy(value)}));fallbackCopy(value)}(current.key)})),meta.appendChild(copyBtn);var manageLink=document.createElement("a");manageLink.className="xlate-inspector-action",manageLink.textContent=STATE.config.strings.openManage||"Open manage UI",manageLink.href=function(key){var resolved,base=STATE.config.manageUrl||"/local/xlate/manage.php";try{resolved=new URL(base,window.location.origin)}catch(e){return(resolved=document.createElement("a")).href=base,resolved.href}STATE.config.courseid&&resolved.searchParams.set("courseid",STATE.config.courseid);key&&resolved.searchParams.set("search",key);return resolved.toString()}(current?current.key:""),manageLink.target="_blank",manageLink.rel="noopener noreferrer",meta.appendChild(manageLink),toolbar.appendChild(meta),toolbar.classList.add("is-visible");var top=rect.top-toolbar.offsetHeight-12;top<8&&(top=rect.bottom+12);var left=rect.left,maxLeft=window.innerWidth-toolbar.offsetWidth-12;left>maxLeft&&(left=Math.max(maxLeft,8));left<8&&(left=8);toolbar.style.left=left+"px",toolbar.style.top=top+"px"}(rect),function(rect){var callout=ensureNode("callout");callout.innerHTML="";var current=getCurrentAttribute();if(!current)return void callout.classList.remove("is-visible");var label=document.createElement("div");label.className="xlate-inspector-callout-label",label.textContent=getAttributeLabel(current.type),callout.appendChild(label);var text=document.createElement("div");text.className="xlate-inspector-callout-text";var preview=current.preview||STATE.config.strings.emptyValue||"No value captured";current.preview||text.classList.add("xlate-inspector-empty");text.textContent=preview,callout.appendChild(text),callout.classList.add("is-visible");var top=rect.bottom+12,left=rect.left,maxLeft=window.innerWidth-callout.offsetWidth-12;left>maxLeft&&(left=Math.max(maxLeft,8));left<8&&(left=8);callout.style.left=left+"px",callout.style.top=top+"px"}(rect)}else clearCurrent()}function ensureNode(key){return NODES[key]?NODES[key]:("highlight"===key?(node=document.createElement("div")).className="xlate-inspector-highlight":"toolbar"===key?(node=document.createElement("div")).className="xlate-inspector-toolbar":"callout"===key&&((node=document.createElement("div")).className="xlate-inspector-callout"),document.body.appendChild(node),NODES[key]=node,node);var node}function getCurrentAttribute(){for(var i=0;i<STATE.attributes.length;i++)if(STATE.attributes[i].type===STATE.currentAttribute)return STATE.attributes[i];return STATE.attributes[0]||null}function getAttributeLabel(type){return STATE.config.strings?"content"===type?STATE.config.strings.attributeContent||"Text":"placeholder"===type?STATE.config.strings.attributePlaceholder||"Placeholder":"title"===type?STATE.config.strings.attributeTitle||"Title":"alt"===type?STATE.config.strings.attributeAlt||"Alt text":"aria-label"===type?STATE.config.strings.attributeAria||"Aria label":type:type}function fallbackCopy(value){var temp=document.createElement("textarea");temp.value=value,temp.setAttribute("readonly","readonly"),temp.style.position="absolute",temp.style.left="-9999px",document.body.appendChild(temp),temp.select();try{document.execCommand("copy"),showToast(STATE.config.strings.copied||"Key copied")}catch(e){console.warn("[local_xlate] Unable to copy key",e)}document.body.removeChild(temp)}function showToast(message){var toast=document.querySelector(".xlate-inspector-toast");toast||((toast=document.createElement("div")).className="xlate-inspector-toast",document.body.appendChild(toast)),toast.textContent=message,toast.classList.add("is-visible"),window.clearTimeout(showToast.timeout),showToast.timeout=window.setTimeout((function(){toast.classList.remove("is-visible")}),2e3)}function clearCurrent(){STATE.currentElement=null,STATE.attributes=[],STATE.currentAttribute=null,hideNode("highlight"),hideNode("toolbar"),hideNode("callout")}function hideNode(key){var node=NODES[key];node&&node.classList.remove("is-visible")}return{init:function(userConfig){var fn;"undefined"!=typeof window&&"undefined"!=typeof document&&(STATE.config=merge(STATE.config,userConfig||{}),STATE.config.enabled&&(fn=function(){!function(){if(!document.querySelector('style[data-xlate-style="inspector"]')){var style=document.createElement("style");style.setAttribute("data-xlate-style","inspector"),style.textContent=".xlate-inspector-toggle{position:fixed;bottom:1.5rem;right:1.5rem;z-index:2147482000;padding:0.65rem 1.1rem;border-radius:999px;box-shadow:0 10px 30px rgba(13,110,253,.25);}.xlate-inspector-toggle.is-active{background:#0b5ed7;}.xlate-inspector-highlight{position:fixed;border:2px dashed #0d6efd;border-radius:0.75rem;pointer-events:none;z-index:2147481000;box-shadow:0 0 0 2px rgba(13,110,253,.2);display:none;}.xlate-inspector-highlight.is-visible{display:block;}.xlate-inspector-toolbar,.xlate-inspector-callout{position:fixed;z-index:2147481200;background:#0d1117;color:#f0f6ff;border-radius:0.6rem;padding:0.75rem;box-shadow:0 12px 45px rgba(15,23,42,.35);display:none;max-width:420px;font-size:0.875rem;}.xlate-inspector-toolbar{display:flex;flex-wrap:wrap;gap:0.5rem;align-items:center;}.xlate-inspector-toolbar.is-visible,.xlate-inspector-callout.is-visible{display:flex;flex-direction:column;}.xlate-inspector-attributes{display:flex;gap:0.25rem;flex-wrap:wrap;}.xlate-inspector-attr{background:rgba(255,255,255,.08);border:none;color:inherit;padding:0.2rem 0.75rem;border-radius:999px;font-size:0.75rem;cursor:pointer;}.xlate-inspector-attr.is-active{background:#1f6feb;}.xlate-inspector-meta{display:flex;gap:0.4rem;flex-wrap:wrap;align-items:center;margin-top:0.35rem;}.xlate-inspector-key{font-family:monospace;background:rgba(255,255,255,.08);padding:0.1rem 0.4rem;border-radius:0.35rem;}.xlate-inspector-action{background:rgba(255,255,255,.08);border:none;color:inherit;padding:0.35rem 0.75rem;border-radius:0.45rem;font-size:0.75rem;cursor:pointer;text-decoration:none;}.xlate-inspector-action:hover{background:rgba(255,255,255,.18);}.xlate-inspector-callout{font-size:0.85rem;gap:0.35rem;}.xlate-inspector-callout-label{font-weight:600;text-transform:uppercase;letter-spacing:0.04em;font-size:0.7rem;color:#93c5fd;}.xlate-inspector-callout-text{max-height:10rem;overflow:auto;white-space:pre-wrap;}.xlate-inspector-toast{position:fixed;bottom:4.75rem;right:1.5rem;background:#0d6efd;color:#fff;padding:0.55rem 1rem;border-radius:0.45rem;box-shadow:0 10px 30px rgba(13,110,253,.35);opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:2147483000;}.xlate-inspector-toast.is-visible{opacity:1;}.xlate-inspector-toggle:focus-visible,.xlate-inspector-attr:focus-visible,.xlate-inspector-action:focus-visible{outline:2px solid #facc15;outline-offset:2px;}.xlate-inspector-empty{opacity:0.6;}",document.head.appendChild(style)}}(),STATE.hasExternalToggle||STATE.config.inlineToggle||function(){if(!STATE.hasExternalToggle&&!NODES.toggle){var button=document.createElement("button");button.type="button",button.className="btn btn-primary xlate-inspector-toggle",button.textContent=STATE.config.strings.toggleInactive||"Enable inspector",button.setAttribute("aria-pressed","false"),button.setAttribute("aria-label",STATE.config.strings.toggleLabel||"Translation inspector"),button.title=STATE.config.strings.toggleHint||"",button.setAttribute("data-xlate-inspector-toggle","true"),attachToggleButton(button),STATE.toggleRenderer=function(active){var activeText=STATE.config.strings.toggleActive||"Inspector enabled",inactiveText=STATE.config.strings.toggleInactive||"Enable inspector";button.textContent=active?activeText:inactiveText},NODES.toggle=button,document.body.appendChild(button),updateToggleVisuals()}}(),STATE.ready=!0,updateToggleVisuals()},"loading"!==document.readyState?fn():document.addEventListener("DOMContentLoaded",fn)))},registerToggle:function(button,options){button&&(STATE.hasExternalToggle=!0,NODES.toggle&&NODES.toggle!==button&&(NODES.toggle.parentNode&&NODES.toggle.parentNode.removeChild(NODES.toggle),function(button){button&&button.removeEventListener("click",handleToggleClick)}(NODES.toggle)),NODES.toggle=button,button.setAttribute("data-xlate-inspector-toggle","true"),options&&"function"==typeof options.render?STATE.toggleRenderer=options.render:STATE.toggleRenderer=null,attachToggleButton(button),updateToggleVisuals())}}}));

//# sourceMappingURL=edit.min.js.map