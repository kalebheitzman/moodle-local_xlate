{"version":3,"file":"langswitcher.min.js","sources":["../src/langswitcher.js"],"sourcesContent":["// Local Xlate floating language switcher.\n// Renders a bottom-left launcher listing available languages.\n\ndefine([], function () {\n    var container = null;\n    var stylesInjected = false;\n    var outsideClickHandler = null;\n    var keydownHandler = null;\n\n    /**\n     * Persist debug information for troubleshooting the switcher state.\n     * @param {Object} state - Key/value pairs describing current status.\n     * @returns {void}\n     */\n    function setDebugState(state) {\n        if (typeof window === 'undefined') {\n            return;\n        }\n        var current = window.XLATE_LANG_SWITCHER_STATE || {};\n        window.XLATE_LANG_SWITCHER_STATE = Object.assign({}, current, state);\n    }\n\n    /**\n     * Remove the currently rendered switcher and event listeners.\n     * @returns {void}\n     */\n    function destroy() {\n        if (outsideClickHandler) {\n            document.removeEventListener('click', outsideClickHandler, true);\n            outsideClickHandler = null;\n        }\n        if (keydownHandler) {\n            document.removeEventListener('keydown', keydownHandler, true);\n            keydownHandler = null;\n        }\n        if (container && container.parentNode) {\n            container.parentNode.removeChild(container);\n        }\n        container = null;\n        setDebugState({ stage: 'destroyed' });\n    }\n\n    /**\n     * Inject the floating switcher styles once per page.\n     * @returns {void}\n     */\n    function injectStyles() {\n        if (stylesInjected) {\n            return;\n        }\n        stylesInjected = true;\n        var style = document.createElement('style');\n        style.setAttribute('data-xlate-style', 'lang-switcher');\n        style.textContent = '' +\n            '.xlate-lang-switcher {' +\n            '  position:fixed;' +\n            '  left:1rem;' +\n            '  bottom:1rem;' +\n            '  z-index:2147483647;' +\n            '  font-family:inherit;' +\n            '}' +\n            '.xlate-lang-switcher__toggle {' +\n            '  background:#0f172a;' +\n            '  color:#fff;' +\n            '  border:none;' +\n            '  border-radius:999px;' +\n            '  min-width:56px;' +\n            '  height:52px;' +\n            '  display:inline-flex;' +\n            '  align-items:center;' +\n            '  justify-content:center;' +\n            '  gap:0.4rem;' +\n            '  padding:0 1rem;' +\n            '  cursor:pointer;' +\n            '  box-shadow:0 14px 30px rgba(15,23,42,0.35);' +\n            '}' +\n            '.xlate-lang-switcher__toggle:focus {' +\n            '  outline:2px solid #fff;' +\n            '  outline-offset:2px;' +\n            '}' +\n            '.xlate-lang-switcher__toggle-code {' +\n            '  text-transform:uppercase;' +\n            '  font-weight:600;' +\n            '  font-size:0.85rem;' +\n            '  letter-spacing:0.05em;' +\n            '}' +\n            '.xlate-lang-switcher__caret {' +\n            '  width:8px;' +\n            '  height:8px;' +\n            '  border:solid #fff;' +\n            '  border-width:0 2px 2px 0;' +\n            '  transform:rotate(-135deg);' +\n            '  transition:transform 0.2s ease;' +\n            '}' +\n            '.xlate-lang-switcher.xlate-open .xlate-lang-switcher__caret,' +\n            '.xlate-lang-switcher:hover .xlate-lang-switcher__caret,' +\n            '.xlate-lang-switcher:focus-within .xlate-lang-switcher__caret {' +\n            '  transform:rotate(45deg);' +\n            '}' +\n            '.xlate-lang-switcher__list {' +\n            '  list-style:none;' +\n            '  margin:0;' +\n            '  padding:0.4rem 0;' +\n            '  background:#fff;' +\n            '  color:#1f2933;' +\n            '  border-radius:0.75rem;' +\n            '  min-width:190px;' +\n            '  box-shadow:0 25px 40px rgba(15,23,42,0.25);' +\n            '  opacity:0;' +\n            '  transform:translateY(10px);' +\n            '  pointer-events:none;' +\n            '  transition:opacity 0.2s ease, transform 0.2s ease;' +\n            '  position:absolute;' +\n            '  bottom:calc(100% + 0.5rem);' +\n            '  left:0;' +\n            '}' +\n            '.xlate-lang-switcher.xlate-open .xlate-lang-switcher__list,' +\n            '.xlate-lang-switcher:hover .xlate-lang-switcher__list,' +\n            '.xlate-lang-switcher:focus-within .xlate-lang-switcher__list {' +\n            '  opacity:1;' +\n            '  transform:translateY(0);' +\n            '  pointer-events:auto;' +\n            '}' +\n            '.xlate-lang-switcher__list li {' +\n            '  margin:0;' +\n            '}' +\n            '.xlate-lang-switcher__link {' +\n            '  display:flex;' +\n            '  align-items:center;' +\n            '  justify-content:space-between;' +\n            '  padding:0.35rem 0.85rem;' +\n            '  text-decoration:none;' +\n            '  color:inherit;' +\n            '  font-size:0.85rem;' +\n            '}' +\n            '.xlate-lang-switcher__link:hover,' +\n            '.xlate-lang-switcher__link:focus {' +\n            '  background:#f3f4f6;' +\n            '}' +\n            '.xlate-lang-switcher__code {' +\n            '  font-size:0.75rem;' +\n            '  color:#4b5563;' +\n            '}' +\n            '.xlate-lang-switcher__link[aria-current=\"true\"] {' +\n            '  font-weight:600;' +\n            '}';\n        document.head.appendChild(style);\n    }\n\n    /**\n     * Toggle the open state of the switcher dropdown.\n     * @param {HTMLButtonElement} button - Toggle button reference.\n     * @param {boolean} [open] - Optional forced state.\n     * @param {boolean} [silent] - When true, skips aria-expanded updates.\n     * @returns {void}\n     */\n    function toggleOpen(button, open, silent) {\n        if (!container) {\n            return;\n        }\n        var shouldOpen = typeof open === 'boolean' ? open : !container.classList.contains('xlate-open');\n        if (shouldOpen) {\n            container.classList.add('xlate-open');\n            if (button && !silent) {\n                button.setAttribute('aria-expanded', 'true');\n            }\n        } else {\n            container.classList.remove('xlate-open');\n            if (button && !silent) {\n                button.setAttribute('aria-expanded', 'false');\n            }\n        }\n    }\n\n    /**\n     * Build the current page URL with the provided lang parameter.\n     * @param {string} code - Language code to inject.\n     * @returns {string} URL pointing to the same page with lang updated.\n     */\n    function computeLangUrl(code) {\n        if (!code) {\n            return window.location.href;\n        }\n        try {\n            var url = new URL(window.location.href);\n            url.searchParams.set('lang', code);\n            return url.toString();\n        } catch (e) {\n            var base = window.location.href.split('#')[0];\n            var cleaned = base.replace(/([?&])lang=[^&#]*(&|$)/, function (match, prefix, suffix) {\n                if (prefix === '?') {\n                    return prefix;\n                }\n                return suffix || '';\n            }).replace(/[?&]$/, '');\n            var sep = cleaned.indexOf('?') === -1 ? '?' : '&';\n            return cleaned + sep + 'lang=' + encodeURIComponent(code);\n        }\n    }\n\n    /**\n     * Initialise the floating language switcher with provided config.\n    * @param {{\n    *   enabled:boolean,\n    *   current:string,\n    *   languages:Array<{code:string,label:string,url:string}>\n    * }} config - Switcher config payload.\n     * @returns {void}\n     */\n    function init(config) {\n        if (!config || !config.enabled || !Array.isArray(config.languages) || config.languages.length < 2) {\n            destroy();\n            setDebugState({ stage: 'disabled', reason: 'invalid_config' });\n            return;\n        }\n\n        if (!document.body) {\n            document.addEventListener('DOMContentLoaded', function handleReady() {\n                document.removeEventListener('DOMContentLoaded', handleReady);\n                init(config);\n            });\n            setDebugState({ stage: 'waiting_body' });\n            return;\n        }\n\n        injectStyles();\n        destroy();\n\n        container = document.createElement('div');\n        container.className = 'xlate-lang-switcher';\n        container.setAttribute('aria-label', 'Language selector');\n\n        var toggle = document.createElement('button');\n        toggle.type = 'button';\n        toggle.className = 'xlate-lang-switcher__toggle';\n        toggle.setAttribute('aria-haspopup', 'listbox');\n        toggle.setAttribute('aria-expanded', 'false');\n\n        var currentEntry = config.languages.find(function (lang) {\n            return lang.code === config.current;\n        });\n        var toggleCode = document.createElement('span');\n        toggleCode.className = 'xlate-lang-switcher__toggle-code';\n        toggleCode.textContent = (currentEntry ? currentEntry.code : config.current).toUpperCase();\n        toggle.appendChild(toggleCode);\n        toggle.setAttribute('aria-label', 'Change language (current ' + toggleCode.textContent + ')');\n\n        var caret = document.createElement('span');\n        caret.className = 'xlate-lang-switcher__caret';\n        caret.setAttribute('aria-hidden', 'true');\n        toggle.appendChild(caret);\n\n        var list = document.createElement('ul');\n        list.className = 'xlate-lang-switcher__list';\n        list.setAttribute('role', 'listbox');\n\n        config.languages.forEach(function (lang) {\n            var item = document.createElement('li');\n            var link = document.createElement('a');\n            link.className = 'xlate-lang-switcher__link';\n            link.href = computeLangUrl(lang.code);\n            link.textContent = lang.label;\n            link.setAttribute('role', 'option');\n            link.setAttribute('data-lang-code', lang.code);\n            if (lang.code === config.current) {\n                link.setAttribute('aria-current', 'true');\n            }\n            var codeBadge = document.createElement('span');\n            codeBadge.className = 'xlate-lang-switcher__code';\n            codeBadge.textContent = lang.code.toUpperCase();\n            link.appendChild(codeBadge);\n            item.appendChild(link);\n            list.appendChild(item);\n        });\n\n        toggle.addEventListener('click', function (e) {\n            e.preventDefault();\n            toggleOpen(toggle);\n            if (container.classList.contains('xlate-open')) {\n                var firstLink = list.querySelector('a');\n                if (firstLink) {\n                    firstLink.focus();\n                }\n            }\n        });\n\n        toggle.addEventListener('keydown', function (e) {\n            if (e.key === 'ArrowDown') {\n                e.preventDefault();\n                toggleOpen(toggle, true);\n                var firstLink = list.querySelector('a');\n                if (firstLink) {\n                    firstLink.focus();\n                }\n            }\n        });\n\n        list.addEventListener('keydown', function (e) {\n            if (e.key === 'Escape') {\n                e.preventDefault();\n                toggle.focus();\n                toggleOpen(toggle, false);\n            }\n        });\n\n        container.appendChild(toggle);\n        container.appendChild(list);\n        document.body.appendChild(container);\n        setDebugState({ stage: 'rendered', languages: config.languages.length });\n\n        outsideClickHandler = function (event) {\n            if (!container) {\n                return;\n            }\n            if (!container.contains(event.target)) {\n                toggleOpen(toggle, false);\n            }\n        };\n        document.addEventListener('click', outsideClickHandler, true);\n\n        keydownHandler = function (event) {\n            if (event.key === 'Escape') {\n                toggleOpen(toggle, false);\n            }\n        };\n        document.addEventListener('keydown', keydownHandler, true);\n    }\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","container","stylesInjected","outsideClickHandler","keydownHandler","setDebugState","state","window","current","XLATE_LANG_SWITCHER_STATE","Object","assign","destroy","document","removeEventListener","parentNode","removeChild","stage","toggleOpen","button","open","silent","classList","contains","add","setAttribute","remove","init","config","enabled","Array","isArray","languages","length","reason","body","addEventListener","handleReady","style","createElement","textContent","head","appendChild","injectStyles","className","toggle","type","currentEntry","find","lang","code","toggleCode","toUpperCase","caret","list","forEach","item","link","href","location","url","URL","searchParams","set","toString","e","cleaned","split","replace","match","prefix","suffix","sep","indexOf","encodeURIComponent","computeLangUrl","label","codeBadge","preventDefault","firstLink","querySelector","focus","key","event","target"],"mappings":"AAGAA,kCAAO,IAAI,eACHC,UAAY,KACZC,gBAAiB,EACjBC,oBAAsB,KACtBC,eAAiB,cAOZC,cAAcC,UACG,oBAAXC,YAGPC,QAAUD,OAAOE,2BAA6B,GAClDF,OAAOE,0BAA4BC,OAAOC,OAAO,GAAIH,QAASF,iBAOzDM,UACDT,sBACAU,SAASC,oBAAoB,QAASX,qBAAqB,GAC3DA,oBAAsB,MAEtBC,iBACAS,SAASC,oBAAoB,UAAWV,gBAAgB,GACxDA,eAAiB,MAEjBH,WAAaA,UAAUc,YACvBd,UAAUc,WAAWC,YAAYf,WAErCA,UAAY,KACZI,cAAc,CAAEY,MAAO,uBAqHlBC,WAAWC,OAAQC,KAAMC,QACzBpB,aAG4B,kBAATmB,KAAqBA,MAAQnB,UAAUqB,UAAUC,SAAS,gBAE9EtB,UAAUqB,UAAUE,IAAI,cACpBL,SAAWE,QACXF,OAAOM,aAAa,gBAAiB,UAGzCxB,UAAUqB,UAAUI,OAAO,cACvBP,SAAWE,QACXF,OAAOM,aAAa,gBAAiB,iBA+J1C,CACHE,cAxHKA,KAAKC,YACLA,SAAWA,OAAOC,UAAYC,MAAMC,QAAQH,OAAOI,YAAcJ,OAAOI,UAAUC,OAAS,SAC5FrB,eACAP,cAAc,CAAEY,MAAO,WAAYiB,OAAQ,uBAI1CrB,SAASsB,YACVtB,SAASuB,iBAAiB,oBAAoB,SAASC,cACnDxB,SAASC,oBAAoB,mBAAoBuB,aACjDV,KAAKC,gBAETvB,cAAc,CAAEY,MAAO,iCA9KvBf,gBAGJA,gBAAiB,MACboC,MAAQzB,SAAS0B,cAAc,SACnCD,MAAMb,aAAa,mBAAoB,iBACvCa,MAAME,YAAc,k/DA6FpB3B,SAAS4B,KAAKC,YAAYJ,QA+E1BK,GACA/B,WAEAX,UAAYY,SAAS0B,cAAc,QACzBK,UAAY,sBACtB3C,UAAUwB,aAAa,aAAc,yBAEjCoB,OAAShC,SAAS0B,cAAc,UACpCM,OAAOC,KAAO,SACdD,OAAOD,UAAY,8BACnBC,OAAOpB,aAAa,gBAAiB,WACrCoB,OAAOpB,aAAa,gBAAiB,aAEjCsB,aAAenB,OAAOI,UAAUgB,MAAK,SAAUC,aACxCA,KAAKC,OAAStB,OAAOpB,WAE5B2C,WAAatC,SAAS0B,cAAc,QACxCY,WAAWP,UAAY,mCACvBO,WAAWX,aAAeO,aAAeA,aAAaG,KAAOtB,OAAOpB,SAAS4C,cAC7EP,OAAOH,YAAYS,YACnBN,OAAOpB,aAAa,aAAc,4BAA8B0B,WAAWX,YAAc,SAErFa,MAAQxC,SAAS0B,cAAc,QACnCc,MAAMT,UAAY,6BAClBS,MAAM5B,aAAa,cAAe,QAClCoB,OAAOH,YAAYW,WAEfC,KAAOzC,SAAS0B,cAAc,MAClCe,KAAKV,UAAY,4BACjBU,KAAK7B,aAAa,OAAQ,WAE1BG,OAAOI,UAAUuB,SAAQ,SAAUN,UAC3BO,KAAO3C,SAAS0B,cAAc,MAC9BkB,KAAO5C,SAAS0B,cAAc,KAClCkB,KAAKb,UAAY,4BACjBa,KAAKC,cAjFWR,UACfA,YACM3C,OAAOoD,SAASD,aAGnBE,IAAM,IAAIC,IAAItD,OAAOoD,SAASD,aAClCE,IAAIE,aAAaC,IAAI,OAAQb,MACtBU,IAAII,WACb,MAAOC,OAEDC,QADO3D,OAAOoD,SAASD,KAAKS,MAAM,KAAK,GACxBC,QAAQ,0BAA0B,SAAUC,MAAOC,OAAQC,cAC3D,MAAXD,OACOA,OAEJC,QAAU,MAClBH,QAAQ,QAAS,IAChBI,KAAgC,IAA1BN,QAAQO,QAAQ,KAAc,IAAM,WACvCP,QAAUM,IAAM,QAAUE,mBAAmBxB,OAgExCyB,CAAe1B,KAAKC,MAChCO,KAAKjB,YAAcS,KAAK2B,MACxBnB,KAAKhC,aAAa,OAAQ,UAC1BgC,KAAKhC,aAAa,iBAAkBwB,KAAKC,MACrCD,KAAKC,OAAStB,OAAOpB,SACrBiD,KAAKhC,aAAa,eAAgB,YAElCoD,UAAYhE,SAAS0B,cAAc,QACvCsC,UAAUjC,UAAY,4BACtBiC,UAAUrC,YAAcS,KAAKC,KAAKE,cAClCK,KAAKf,YAAYmC,WACjBrB,KAAKd,YAAYe,MACjBH,KAAKZ,YAAYc,SAGrBX,OAAOT,iBAAiB,SAAS,SAAU6B,MACvCA,EAAEa,iBACF5D,WAAW2B,QACP5C,UAAUqB,UAAUC,SAAS,cAAe,KACxCwD,UAAYzB,KAAK0B,cAAc,KAC/BD,WACAA,UAAUE,YAKtBpC,OAAOT,iBAAiB,WAAW,SAAU6B,MAC3B,cAAVA,EAAEiB,IAAqB,CACvBjB,EAAEa,iBACF5D,WAAW2B,QAAQ,OACfkC,UAAYzB,KAAK0B,cAAc,KAC/BD,WACAA,UAAUE,YAKtB3B,KAAKlB,iBAAiB,WAAW,SAAU6B,GACzB,WAAVA,EAAEiB,MACFjB,EAAEa,iBACFjC,OAAOoC,QACP/D,WAAW2B,QAAQ,OAI3B5C,UAAUyC,YAAYG,QACtB5C,UAAUyC,YAAYY,MACtBzC,SAASsB,KAAKO,YAAYzC,WAC1BI,cAAc,CAAEY,MAAO,WAAYe,UAAWJ,OAAOI,UAAUC,SAE/D9B,oBAAsB,SAAUgF,OACvBlF,YAGAA,UAAUsB,SAAS4D,MAAMC,SAC1BlE,WAAW2B,QAAQ,KAG3BhC,SAASuB,iBAAiB,QAASjC,qBAAqB,GAExDC,eAAiB,SAAU+E,OACL,WAAdA,MAAMD,KACNhE,WAAW2B,QAAQ,IAG3BhC,SAASuB,iBAAiB,UAAWhC,gBAAgB"}