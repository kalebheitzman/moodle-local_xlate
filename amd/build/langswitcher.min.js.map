{"version":3,"file":"langswitcher.min.js","sources":["../src/langswitcher.js"],"sourcesContent":["// Local Xlate floating language switcher.\n// Renders a bottom-left launcher listing available languages.\n\ndefine([], function () {\n    var container = null;\n    var stylesInjected = false;\n    var outsideClickHandler = null;\n    var keydownHandler = null;\n    var translationPillButton = null;\n    var translationPillLabel = null;\n    var translationPillConfig = null;\n    var translationVisibilityListener = null;\n    var translationReadyListener = null;\n    var translationsVisibleState = true;\n    var translationToggleReady = false;\n\n    /**\n     * Persist debug information for troubleshooting the switcher state.\n     * @param {Object} state - Key/value pairs describing current status.\n     * @returns {void}\n     */\n    function setDebugState(state) {\n        if (typeof window === 'undefined') {\n            return;\n        }\n        var current = window.XLATE_LANG_SWITCHER_STATE || {};\n        window.XLATE_LANG_SWITCHER_STATE = Object.assign({}, current, state);\n    }\n\n    /**\n     * Remove the currently rendered switcher and event listeners.\n     * @returns {void}\n     */\n    function destroy() {\n        if (outsideClickHandler) {\n            document.removeEventListener('click', outsideClickHandler, true);\n            outsideClickHandler = null;\n        }\n        if (keydownHandler) {\n            document.removeEventListener('keydown', keydownHandler, true);\n            keydownHandler = null;\n        }\n        if (container && container.parentNode) {\n            container.parentNode.removeChild(container);\n        }\n        container = null;\n        translationPillConfig = null;\n        translationPillLabel = null;\n        translationPillButton = null;\n        translationToggleReady = false;\n        translationsVisibleState = true;\n        if (translationVisibilityListener) {\n            document.removeEventListener('xlate:visibilitychange', translationVisibilityListener);\n            translationVisibilityListener = null;\n        }\n        if (translationReadyListener) {\n            document.removeEventListener('xlate:ready', translationReadyListener);\n            translationReadyListener = null;\n        }\n        setDebugState({ stage: 'destroyed' });\n    }\n\n    /**\n     * Inject the floating switcher styles once per page.\n     * @returns {void}\n     */\n    function injectStyles() {\n        if (stylesInjected) {\n            return;\n        }\n        stylesInjected = true;\n        var style = document.createElement('style');\n        style.setAttribute('data-xlate-style', 'lang-switcher');\n        style.textContent = '' +\n            '.xlate-lang-switcher {' +\n            '  position:fixed;' +\n            '  left:1rem;' +\n            '  bottom:1rem;' +\n            '  z-index:2147483647;' +\n            '  font-family:inherit;' +\n            '  padding-bottom:0.4rem;' +\n            '  display:flex;' +\n            '  align-items:flex-end;' +\n            '  gap:0.75rem;' +\n            '  flex-wrap:wrap;' +\n            '}' +\n            '.xlate-lang-switcher__control {' +\n            '  position:relative;' +\n            '  display:inline-block;' +\n            '}' +\n            '.xlate-lang-switcher__toggle {' +\n            '  background:#0f172a;' +\n            '  color:#fff;' +\n            '  border:none;' +\n            '  border-radius:1.5rem;' +\n            '  min-width:62px;' +\n            '  height:46px;' +\n            '  display:inline-flex;' +\n            '  align-items:center;' +\n            '  justify-content:center;' +\n            '  gap:0.5rem;' +\n            '  padding:0 1rem 0 1.1rem;' +\n            '  cursor:pointer;' +\n            '  box-shadow:0 14px 30px rgba(15,23,42,0.35);' +\n            '}' +\n            '.xlate-lang-switcher__toggle:focus {' +\n            '  outline:2px solid #fff;' +\n            '  outline-offset:2px;' +\n            '}' +\n            '.xlate-lang-switcher__toggle-code {' +\n            '  text-transform:uppercase;' +\n            '  font-weight:600;' +\n            '  font-size:0.85rem;' +\n            '  letter-spacing:0.05em;' +\n            '}' +\n            '.xlate-lang-switcher__caret-wrap {' +\n            '  background:rgba(255,255,255,0.18);' +\n            '  border-radius:999px;' +\n            '  width:24px;' +\n            '  height:24px;' +\n            '  display:flex;' +\n            '  align-items:center;' +\n            '  justify-content:center;' +\n            '}' +\n            '.xlate-lang-switcher__caret {' +\n            '  width:9px;' +\n            '  height:9px;' +\n            '  border:solid #fff;' +\n            '  border-width:0 2px 2px 0;' +\n            '  transform:rotate(-135deg);' +\n            '  transition:transform 0.2s ease;' +\n            '}' +\n            '.xlate-lang-switcher.xlate-open .xlate-lang-switcher__caret,' +\n            '.xlate-lang-switcher__control:hover .xlate-lang-switcher__caret,' +\n            '.xlate-lang-switcher__control:focus-within .xlate-lang-switcher__caret {' +\n            '  transform:rotate(45deg);' +\n            '}' +\n            '.xlate-lang-switcher__list {' +\n            '  list-style:none;' +\n            '  margin:0;' +\n            '  padding:0.4rem 0;' +\n            '  background:#fff;' +\n            '  color:#1f2933;' +\n            '  border-radius:0.75rem;' +\n            '  min-width:190px;' +\n            '  box-shadow:0 25px 40px rgba(15,23,42,0.25);' +\n            '  opacity:0;' +\n            '  transform:translateY(10px);' +\n            '  pointer-events:none;' +\n            '  transition:opacity 0.2s ease, transform 0.2s ease;' +\n            '  position:absolute;' +\n            '  bottom:calc(100% + 0.2rem);' +\n            '  left:0;' +\n            '}' +\n            '.xlate-lang-switcher__list::after {' +\n            '  content:\"\";' +\n            '  position:absolute;' +\n            '  left:1.25rem;' +\n            '  bottom:-0.55rem;' +\n            '  width:1.4rem;' +\n            '  height:0.65rem;' +\n            '  background:#fff;' +\n            '  box-shadow:0 12px 22px rgba(15,23,42,0.15);' +\n            '  border-bottom-left-radius:0.65rem;' +\n            '  border-bottom-right-radius:0.65rem;' +\n            '}' +\n            '.xlate-lang-switcher.xlate-open .xlate-lang-switcher__list,' +\n            '.xlate-lang-switcher__control:hover .xlate-lang-switcher__list,' +\n            '.xlate-lang-switcher__control:focus-within .xlate-lang-switcher__list {' +\n            '  opacity:1;' +\n            '  transform:translateY(0);' +\n            '  pointer-events:auto;' +\n            '}' +\n            '.xlate-lang-switcher__list li {' +\n            '  margin:0;' +\n            '}' +\n            '.xlate-lang-switcher__link {' +\n            '  display:flex;' +\n            '  align-items:center;' +\n            '  justify-content:space-between;' +\n            '  padding:0.35rem 0.85rem;' +\n            '  text-decoration:none;' +\n            '  color:inherit;' +\n            '  font-size:0.85rem;' +\n            '}' +\n            '.xlate-lang-switcher__link:hover,' +\n            '.xlate-lang-switcher__link:focus {' +\n            '  background:#f3f4f6;' +\n            '}' +\n            '.xlate-lang-switcher__code {' +\n            '  font-size:0.75rem;' +\n            '  color:#4b5563;' +\n            '}' +\n            '.xlate-lang-switcher__link[aria-current=\"true\"] {' +\n            '  font-weight:600;' +\n            '}' +\n            '.xlate-lang-switcher__pill {' +\n            '  border:none;' +\n            '  border-radius:1.5rem;' +\n            '  height:46px;' +\n            '  padding:0 1.25rem;' +\n            '  font-weight:600;' +\n            '  font-size:0.85rem;' +\n            '  display:inline-flex;' +\n            '  align-items:center;' +\n            '  gap:0.5rem;' +\n            '  cursor:pointer;' +\n            '  transition:background 0.2s ease, color 0.2s ease, opacity 0.2s ease;' +\n            '}' +\n            '.xlate-lang-switcher__pill:focus {' +\n            '  outline:2px solid #cbd5f5;' +\n            '  outline-offset:2px;' +\n            '}' +\n            '.xlate-lang-switcher__pill.is-disabled {' +\n            '  opacity:0.6;' +\n            '  cursor:not-allowed;' +\n            '}' +\n            '.xlate-lang-switcher__notice {' +\n            '  background:#374151;' +\n            '  color:#f9fafb;' +\n            '  border:none;' +\n            '  border-radius:1.5rem;' +\n            '  height:46px;' +\n            '  padding:0 1.2rem 0 1.35rem;' +\n            '  font-weight:600;' +\n            '  font-size:0.85rem;' +\n            '  cursor:pointer;' +\n            '  box-shadow:0 14px 32px rgba(15,23,42,0.2);' +\n            '  transition:background 0.2s ease, color 0.2s ease, opacity 0.2s ease;' +\n            '}' +\n            '.xlate-lang-switcher__notice:hover,' +\n            '.xlate-lang-switcher__notice:focus {' +\n            '  background:#4b5563;' +\n            '}' +\n            '.xlate-lang-switcher__notice[aria-disabled=\"true\"] {' +\n            '  opacity:0.55;' +\n            '  cursor:not-allowed;' +\n            '}' +\n            '.xlate-lang-switcher__notice.is-muted {' +\n            '  background:#1f2937;' +\n            '  color:#f3f4f6;' +\n            '}' +\n            '.xlate-lang-switcher__notice-label {' +\n            '  white-space:nowrap;' +\n            '}' +\n            '.xlate-lang-switcher__inspector {' +\n            '  background:#111827;' +\n            '  color:#e0f2fe;' +\n            '  box-shadow:0 12px 28px rgba(15,23,42,0.35);' +\n            '  width:46px;' +\n            '  padding:0;' +\n            '  justify-content:center;' +\n            '}' +\n            '.xlate-lang-switcher__inspector.is-active {' +\n            '  background:#1d4ed8;' +\n            '  color:#e0f2fe;' +\n            '}' +\n            '.xlate-lang-switcher__inspector-icon {' +\n            '  width:1.6rem;' +\n            '  height:1.6rem;' +\n            '  border-radius:999px;' +\n            '  background:rgba(59,130,246,0.25);' +\n            '  display:inline-flex;' +\n            '  align-items:center;' +\n            '  justify-content:center;' +\n            '}' +\n            '.xlate-lang-switcher__inspector-icon svg {' +\n            '  width:1.05rem;' +\n            '  height:1.05rem;' +\n            '  fill:currentColor;' +\n            '  display:block;' +\n            '}' +\n            '.xlate-lang-switcher__inspector-icon svg + svg {' +\n            '  display:none;' +\n            '}' +\n            '.xlate-lang-switcher__inspector.is-active .xlate-lang-switcher__inspector-icon svg:first-child {' +\n            '  display:none;' +\n            '}' +\n            '.xlate-lang-switcher__inspector.is-active .xlate-lang-switcher__inspector-icon svg:last-child {' +\n            '  display:block;' +\n            '}' +\n            '.xlate-visually-hidden {' +\n            '  position:absolute;' +\n            '  width:1px;' +\n            '  height:1px;' +\n            '  padding:0;' +\n            '  margin:-1px;' +\n            '  overflow:hidden;' +\n            '  clip:rect(0,0,0,0);' +\n            '  border:0;' +\n            '  white-space:nowrap;' +\n            '}';\n        document.head.appendChild(style);\n    }\n\n    /**\n     * Toggle the open state of the switcher dropdown.\n     * @param {HTMLButtonElement} button - Toggle button reference.\n     * @param {boolean} [open] - Optional forced state.\n     * @param {boolean} [silent] - When true, skips aria-expanded updates.\n     * @returns {void}\n     */\n    function toggleOpen(button, open, silent) {\n        if (!container) {\n            return;\n        }\n        var shouldOpen = typeof open === 'boolean' ? open : !container.classList.contains('xlate-open');\n        if (shouldOpen) {\n            container.classList.add('xlate-open');\n            if (button && !silent) {\n                button.setAttribute('aria-expanded', 'true');\n            }\n        } else {\n            container.classList.remove('xlate-open');\n            if (button && !silent) {\n                button.setAttribute('aria-expanded', 'false');\n            }\n        }\n    }\n\n    /**\n     * Build the current page URL with the provided lang parameter.\n     * @param {string} code - Language code to inject.\n     * @returns {string} URL pointing to the same page with lang updated.\n     */\n    function computeLangUrl(code) {\n        if (!code) {\n            return window.location.href;\n        }\n        try {\n            var url = new URL(window.location.href);\n            url.searchParams.set('lang', code);\n            return url.toString();\n        } catch (e) {\n            var base = window.location.href.split('#')[0];\n            var cleaned = base.replace(/([?&])lang=[^&#]*(&|$)/, function (match, prefix, suffix) {\n                if (prefix === '?') {\n                    return prefix;\n                }\n                return suffix || '';\n            }).replace(/[?&]$/, '');\n            var sep = cleaned.indexOf('?') === -1 ? '?' : '&';\n            return cleaned + sep + 'lang=' + encodeURIComponent(code);\n        }\n    }\n\n    /**\n     * Update the translation notice pill text to reflect current state.\n     * @returns {void}\n     */\n    function updateTranslationPillLabel() {\n        if (!translationPillLabel || !translationPillConfig) {\n            return;\n        }\n        var defaultLabel = translationPillConfig.label || '';\n        var originalLabel = translationPillConfig.originalLabel || translationPillConfig.hoverShowTranslated || defaultLabel;\n        translationPillLabel.textContent = translationsVisibleState ? defaultLabel : originalLabel;\n        if (translationPillButton) {\n            translationPillButton.setAttribute('aria-pressed', translationsVisibleState ? 'false' : 'true');\n            if (translationsVisibleState) {\n                translationPillButton.classList.remove('is-muted');\n            } else {\n                translationPillButton.classList.add('is-muted');\n            }\n        }\n    }\n\n    /**\n     * Update internal readiness state and toggle aria-disabled semantics.\n     * @param {boolean} ready - Whether the translator runtime can toggle visibility.\n     * @returns {void}\n     */\n    function setTranslationToggleReady(ready) {\n        translationToggleReady = !!ready;\n        if (translationPillButton) {\n            translationPillButton.setAttribute('aria-disabled', translationToggleReady ? 'false' : 'true');\n        }\n    }\n\n    /**\n     * Temporarily swap the pill text while hovering/focusing.\n     * @param {boolean} active - Whether the hover/focus state is active.\n     * @returns {void}\n     */\n    function setTranslationPillHover(active) {\n        if (!translationPillLabel || !translationPillConfig) {\n            return;\n        }\n        if (!active) {\n            updateTranslationPillLabel();\n            return;\n        }\n        var hoverLabel = translationsVisibleState ?\n            (translationPillConfig.hoverShowOriginal || translationPillConfig.label || '') :\n            (translationPillConfig.hoverShowTranslated || translationPillConfig.originalLabel || translationPillConfig.label || '');\n        translationPillLabel.textContent = hoverLabel;\n    }\n\n    /**\n     * Render the translation notice/toggle pill and wire up events.\n     * @param {Object} toggleConfig - Translation toggle labels/config.\n     * @returns {void}\n     */\n    function initTranslationPill(toggleConfig) {\n        if (!toggleConfig || !toggleConfig.enabled) {\n            return;\n        }\n        translationPillConfig = toggleConfig;\n        translationPillButton = document.createElement('button');\n        translationPillButton.type = 'button';\n        translationPillButton.className = 'xlate-lang-switcher__notice xlate-lang-switcher__pill';\n        translationPillButton.setAttribute('aria-disabled', 'true');\n        translationPillButton.setAttribute('aria-live', 'polite');\n        translationPillButton.setAttribute('aria-pressed', 'false');\n        if (toggleConfig.tooltip) {\n            translationPillButton.setAttribute('title', toggleConfig.tooltip);\n        }\n        translationPillLabel = document.createElement('span');\n        translationPillLabel.className = 'xlate-lang-switcher__notice-label';\n        translationPillLabel.textContent = toggleConfig.label || '';\n        translationPillButton.appendChild(translationPillLabel);\n        if (toggleConfig.help) {\n            var helpId = 'xlate-toggle-help-' + Math.random().toString(36).slice(2);\n            var helpNode = document.createElement('span');\n            helpNode.className = 'xlate-visually-hidden';\n            helpNode.id = helpId;\n            helpNode.textContent = toggleConfig.help;\n            translationPillButton.appendChild(helpNode);\n            translationPillButton.setAttribute('aria-describedby', helpId);\n        }\n\n        ['mouseenter', 'focus'].forEach(function (evt) {\n            translationPillButton.addEventListener(evt, function () {\n                setTranslationPillHover(true);\n            });\n        });\n        ['mouseleave', 'blur'].forEach(function (evt) {\n            translationPillButton.addEventListener(evt, function () {\n                setTranslationPillHover(false);\n            });\n        });\n        translationPillButton.addEventListener('click', function (e) {\n            e.preventDefault();\n            var targetVisible = !translationsVisibleState;\n            var clickTime = Date.now();\n            var isReady = translationToggleReady && typeof window !== 'undefined' &&\n                window.__XLATE__ && typeof window.__XLATE__.setTranslationVisibility === 'function';\n            setDebugState({\n                lastClick: clickTime,\n                requestedVisible: targetVisible,\n                toggleReady: isReady\n            });\n            if (!isReady) {\n                return;\n            }\n            window.__XLATE__.setTranslationVisibility(targetVisible);\n        });\n\n        translationVisibilityListener = function (event) {\n            var detail = event && event.detail ? event.detail : {};\n            translationsVisibleState = detail.visible !== false;\n            updateTranslationPillLabel();\n        };\n        document.addEventListener('xlate:visibilitychange', translationVisibilityListener);\n\n        translationReadyListener = function (event) {\n            var detail = event && event.detail ? event.detail : {};\n            var ready = detail.isTargetLang !== false && !detail.isCapture;\n            setTranslationToggleReady(ready);\n            if (ready && window.__XLATE__) {\n                translationsVisibleState = window.__XLATE__.showTranslations !== false;\n            }\n            updateTranslationPillLabel();\n        };\n        document.addEventListener('xlate:ready', translationReadyListener);\n\n        if (window.__XLATE__) {\n            var readyNow = window.__XLATE__.isTargetLang !== false && !window.__XLATE__.isCapture;\n            setTranslationToggleReady(readyNow);\n            translationsVisibleState = window.__XLATE__.showTranslations !== false;\n        } else {\n            setTranslationToggleReady(false);\n            translationsVisibleState = true;\n        }\n\n        updateTranslationPillLabel();\n        container.appendChild(translationPillButton);\n    }\n\n    /**\n     * Render the inspector toggle pill, wiring it to the inspector runtime.\n     * @param {Object} toggleConfig - Inspector toggle label/tooltip config.\n     * @returns {HTMLButtonElement|null} Rendered button when allowed.\n     */\n    function initInspectorPill(toggleConfig) {\n        if (!toggleConfig || !toggleConfig.enabled) {\n            return null;\n        }\n        var button = document.createElement('button');\n        button.type = 'button';\n        button.className = 'xlate-lang-switcher__inspector xlate-lang-switcher__pill';\n        button.setAttribute('aria-pressed', 'false');\n        if (toggleConfig.tooltip) {\n            button.setAttribute('title', toggleConfig.tooltip);\n        }\n        button.setAttribute('aria-live', 'polite');\n        button.setAttribute('data-xlate-inspector-toggle', 'true');\n        var icon = document.createElement('span');\n        icon.className = 'xlate-lang-switcher__inspector-icon';\n        icon.setAttribute('aria-hidden', 'true');\n        var NS = 'http://www.w3.org/2000/svg';\n        var buildPencilSvg = function () {\n            var svgEl = document.createElementNS(NS, 'svg');\n            svgEl.setAttribute('viewBox', '0 0 24 24');\n            svgEl.setAttribute('role', 'presentation');\n            var body = document.createElementNS(NS, 'path');\n            body.setAttribute('d', 'M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z');\n            var tip = document.createElementNS(NS, 'path');\n            tip.setAttribute('d', 'M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z');\n            svgEl.appendChild(body);\n            svgEl.appendChild(tip);\n            return svgEl;\n        };\n        var enableSvg = buildPencilSvg();\n        var disableSvg = buildPencilSvg();\n        var slash = document.createElementNS(NS, 'path');\n        slash.setAttribute('d', 'M5 19L19 5');\n        slash.setAttribute('fill', 'none');\n        slash.setAttribute('stroke', 'currentColor');\n        slash.setAttribute('stroke-width', '2');\n        slash.setAttribute('stroke-linecap', 'round');\n        disableSvg.appendChild(slash);\n        icon.appendChild(enableSvg);\n        icon.appendChild(disableSvg);\n        button.appendChild(icon);\n        var srLabel = document.createElement('span');\n        srLabel.className = 'xlate-visually-hidden';\n        var initialLabel = toggleConfig.inactiveLabel || toggleConfig.label || toggleConfig.ariaLabel || 'Enable inspector';\n        srLabel.textContent = initialLabel;\n        button.appendChild(srLabel);\n        button.setAttribute('aria-label', initialLabel);\n\n        if (typeof require === 'function') {\n            require(['local_xlate/edit'], function (inspector) {\n                if (!inspector || typeof inspector.registerToggle !== 'function') {\n                    return;\n                }\n                inspector.registerToggle(button, {\n                    render: function (active) {\n                        var next = active ?\n                            (toggleConfig.activeLabel || toggleConfig.label || '') :\n                            (toggleConfig.inactiveLabel || toggleConfig.label || '');\n                        srLabel.textContent = next;\n                        button.setAttribute('aria-label', next || toggleConfig.label || 'Inspector');\n                    }\n                });\n            });\n        }\n\n        return button;\n    }\n\n    /**\n     * Initialise the floating language switcher with provided config.\n    * @param {{\n    *   enabled:boolean,\n    *   current:string,\n    *   languages:Array<{code:string,label:string,url:string}>,\n    *   ariaLabel?:string,\n    *   toggleAriaLabel?:string,\n    *   translationToggle?:{\n    *       enabled:boolean,\n    *       label:string,\n    *       originalLabel:string,\n    *       hoverShowOriginal:string,\n    *       hoverShowTranslated:string,\n    *       tooltip:string,\n    *       help:string\n    *   }\n    * }} config - Switcher config payload.\n     * @returns {void}\n     */\n    function init(config) {\n        if (!config || !config.enabled || !Array.isArray(config.languages) || config.languages.length < 2) {\n            destroy();\n            setDebugState({ stage: 'disabled', reason: 'invalid_config' });\n            return;\n        }\n\n        if (!document.body) {\n            document.addEventListener('DOMContentLoaded', function handleReady() {\n                document.removeEventListener('DOMContentLoaded', handleReady);\n                init(config);\n            });\n            setDebugState({ stage: 'waiting_body' });\n            return;\n        }\n\n        injectStyles();\n        destroy();\n\n        container = document.createElement('div');\n        container.className = 'xlate-lang-switcher';\n        var containerLabel = (config.ariaLabel || 'Language selector');\n        container.setAttribute('aria-label', containerLabel);\n\n        var inspectorButton = null;\n        if (config.inspectorToggle && config.inspectorToggle.enabled) {\n            inspectorButton = initInspectorPill(config.inspectorToggle);\n            if (inspectorButton) {\n                container.appendChild(inspectorButton);\n            }\n        }\n\n        var toggle = document.createElement('button');\n        toggle.type = 'button';\n        toggle.className = 'xlate-lang-switcher__toggle';\n        toggle.setAttribute('aria-haspopup', 'listbox');\n        toggle.setAttribute('aria-expanded', 'false');\n\n        var currentEntry = config.languages.find(function (lang) {\n            return lang.code === config.current;\n        });\n        var toggleCode = document.createElement('span');\n        toggleCode.className = 'xlate-lang-switcher__toggle-code';\n        toggleCode.textContent = (currentEntry ? currentEntry.code : config.current).toUpperCase();\n        toggle.appendChild(toggleCode);\n        var toggleAriaLabel = config.toggleAriaLabel || ('Change language (current ' + toggleCode.textContent + ')');\n        toggle.setAttribute('aria-label', toggleAriaLabel);\n\n        var caretWrap = document.createElement('span');\n        caretWrap.className = 'xlate-lang-switcher__caret-wrap';\n        var caret = document.createElement('span');\n        caret.className = 'xlate-lang-switcher__caret';\n        caret.setAttribute('aria-hidden', 'true');\n        caretWrap.appendChild(caret);\n        toggle.appendChild(caretWrap);\n\n        var list = document.createElement('ul');\n        list.className = 'xlate-lang-switcher__list';\n        list.setAttribute('role', 'listbox');\n\n        config.languages.forEach(function (lang) {\n            var item = document.createElement('li');\n            var link = document.createElement('a');\n            link.className = 'xlate-lang-switcher__link';\n            link.href = computeLangUrl(lang.code);\n            link.textContent = lang.label;\n            link.setAttribute('role', 'option');\n            link.setAttribute('data-lang-code', lang.code);\n            if (lang.code === config.current) {\n                link.setAttribute('aria-current', 'true');\n            }\n            var codeBadge = document.createElement('span');\n            codeBadge.className = 'xlate-lang-switcher__code';\n            codeBadge.textContent = lang.code.toUpperCase();\n            link.appendChild(codeBadge);\n            item.appendChild(link);\n            list.appendChild(item);\n        });\n\n        toggle.addEventListener('click', function (e) {\n            e.preventDefault();\n            toggleOpen(toggle);\n            if (container.classList.contains('xlate-open')) {\n                var firstLink = list.querySelector('a');\n                if (firstLink) {\n                    firstLink.focus();\n                }\n            }\n        });\n\n        toggle.addEventListener('keydown', function (e) {\n            if (e.key === 'ArrowDown') {\n                e.preventDefault();\n                toggleOpen(toggle, true);\n                var firstLink = list.querySelector('a');\n                if (firstLink) {\n                    firstLink.focus();\n                }\n            }\n        });\n\n        list.addEventListener('keydown', function (e) {\n            if (e.key === 'Escape') {\n                e.preventDefault();\n                toggle.focus();\n                toggleOpen(toggle, false);\n            }\n        });\n\n        var control = document.createElement('div');\n        control.className = 'xlate-lang-switcher__control';\n        control.appendChild(toggle);\n        control.appendChild(list);\n        container.appendChild(control);\n\n        if (config.translationToggle && config.translationToggle.enabled) {\n            initTranslationPill(config.translationToggle);\n        }\n\n        document.body.appendChild(container);\n        setDebugState({\n            stage: 'rendered',\n            languages: config.languages.length,\n            translationPill: !!(config.translationToggle && config.translationToggle.enabled),\n            inspectorPill: !!(config.inspectorToggle && config.inspectorToggle.enabled)\n        });\n\n        outsideClickHandler = function (event) {\n            if (!container) {\n                return;\n            }\n            if (!container.contains(event.target)) {\n                toggleOpen(toggle, false);\n            }\n        };\n        document.addEventListener('click', outsideClickHandler, true);\n\n        keydownHandler = function (event) {\n            if (event.key === 'Escape') {\n                toggleOpen(toggle, false);\n            }\n        };\n        document.addEventListener('keydown', keydownHandler, true);\n    }\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","container","stylesInjected","outsideClickHandler","keydownHandler","translationPillButton","translationPillLabel","translationPillConfig","translationVisibilityListener","translationReadyListener","translationsVisibleState","translationToggleReady","setDebugState","state","window","current","XLATE_LANG_SWITCHER_STATE","Object","assign","destroy","document","removeEventListener","parentNode","removeChild","stage","toggleOpen","button","open","silent","classList","contains","add","setAttribute","remove","updateTranslationPillLabel","defaultLabel","label","originalLabel","hoverShowTranslated","textContent","setTranslationToggleReady","ready","setTranslationPillHover","active","hoverLabel","hoverShowOriginal","init","config","enabled","Array","isArray","languages","length","reason","body","addEventListener","handleReady","style","createElement","head","appendChild","injectStyles","className","containerLabel","ariaLabel","inspectorButton","inspectorToggle","toggleConfig","type","tooltip","icon","NS","buildPencilSvg","svgEl","createElementNS","tip","enableSvg","disableSvg","slash","srLabel","initialLabel","inactiveLabel","require","inspector","registerToggle","render","next","activeLabel","initInspectorPill","toggle","currentEntry","find","lang","code","toggleCode","toUpperCase","toggleAriaLabel","caretWrap","caret","list","forEach","item","link","href","location","url","URL","searchParams","set","toString","e","cleaned","split","replace","match","prefix","suffix","sep","indexOf","encodeURIComponent","computeLangUrl","codeBadge","preventDefault","firstLink","querySelector","focus","key","control","translationToggle","help","helpId","Math","random","slice","helpNode","id","evt","targetVisible","clickTime","Date","now","isReady","__XLATE__","setTranslationVisibility","lastClick","requestedVisible","toggleReady","event","detail","visible","isTargetLang","isCapture","showTranslations","initTranslationPill","translationPill","inspectorPill","target"],"mappings":"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"}