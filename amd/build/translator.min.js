define("local_xlate/translator",["core/ajax"],(function(Ajax){var autoDetectEnabled=!0,detectedStrings=new Set,processedElements=new WeakSet;function translateNode(node,map){if(1===node.nodeType){var key=node.getAttribute&&node.getAttribute("data-xlate");key&&map[key]&&(node.textContent=map[key]),["placeholder","title","alt","aria-label"].forEach((function(attr){var akey=node.getAttribute&&node.getAttribute("data-xlate-"+attr);akey&&map[akey]&&node.setAttribute(attr,map[akey])}))}}function autoDetectString(element,text,type){if(autoDetectEnabled&&text&&!(text.length<2)){var uniqueId=text+":"+type+":"+element.tagName;if(!detectedStrings.has(uniqueId)){detectedStrings.add(uniqueId);var component=function(element){var container=element.closest("[data-region]");if(container){var region=container.getAttribute("data-region");if(region)return"region_"+region}if(container=element.closest(".block")){var blockClass=container.className.match(/block_(\w+)/);if(blockClass)return"block_"+blockClass[1]}if(container=element.closest(".activity")){var activityClass=container.className.match(/modtype_(\w+)/);if(activityClass)return"mod_"+activityClass[1]}return document.body.classList.contains("path-admin")?"admin":"core"}(element),key=function(element,text,type){var tagName=element.tagName.toLowerCase(),keyParts=[];"placeholder"===type?keyParts.push("Input"):["h1","h2","h3","h4","h5","h6"].includes(tagName)?keyParts.push("Heading"):"button"===tagName||"input"===tagName&&"submit"===element.type?keyParts.push("Button"):"a"===tagName?keyParts.push("Link"):"label"===tagName?keyParts.push("Label"):"alt"===type?keyParts.push("Image"):"title"===type&&keyParts.push("Title");var cleanText=text.replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim().split(" ").map((function(word){return word.charAt(0).toUpperCase()+word.slice(1).toLowerCase()})).join("");return cleanText?keyParts.push(cleanText):keyParts.push("Text"),type&&"text"!==type&&keyParts.push(type.charAt(0).toUpperCase()+type.slice(1)),keyParts.join(".")}(element,text,type);Ajax.call([{methodname:"local_xlate_save_key",args:{component:component,key:key,source:text,lang:M.cfg.language||"en",translation:text}}])[0].then((function(){var attrName="data-xlate"+("text"!==type?"-"+type:"");return element.setAttribute(attrName,key),window.__XLATE__&&window.__XLATE__.map&&(window.__XLATE__.map[key]=text),!0})).catch((function(){detectedStrings.delete(uniqueId)}))}}}function walk(root,map){for(var element,stack=[root];stack.length;){var el=stack.pop();if(1===el.nodeType){if(el.hasAttribute&&el.hasAttribute("data-xlate-ignore"))continue;translateNode(el,map),autoDetectEnabled&&(function(element){var tagName=element.tagName.toLowerCase();return!!(["script","style","meta","link","noscript","head"].includes(tagName)||element.hasAttribute("data-xlate-ignore")||element.closest("[data-xlate-ignore]")||element.hasAttribute("data-xlate")||element.hasAttribute("data-xlate-placeholder")||element.hasAttribute("data-xlate-title")||element.hasAttribute("data-xlate-alt"))}(element=el)||processedElements.has(element)||(processedElements.add(element),1===element.childNodes.length&&3===element.childNodes[0].nodeType&&element.textContent.trim()&&autoDetectString(element,element.textContent.trim(),"text"),element.hasAttribute("placeholder")&&element.getAttribute("placeholder").trim()&&autoDetectString(element,element.getAttribute("placeholder").trim(),"placeholder"),element.hasAttribute("title")&&element.getAttribute("title").trim()&&autoDetectString(element,element.getAttribute("title").trim(),"title"),element.hasAttribute("alt")&&element.getAttribute("alt").trim()&&autoDetectString(element,element.getAttribute("alt").trim(),"alt")));for(var children=el.children||[],i=0;i<children.length;i++)stack.push(children[i])}}}function run(map){try{walk(document.body,map||{}),autoDetectEnabled&&setTimeout((function(){walk(document.body,map||{})}),1e3),new MutationObserver((function(muts){muts.forEach((function(m){(m.addedNodes||[]).forEach((function(n){1===n.nodeType&&walk(n,map||{})}))}))})).observe(document.body,{childList:!0,subtree:!0})}finally{document.documentElement.classList.remove("xlate-loading")}}return{run:run,init:function(config){document.documentElement.classList.add("xlate-loading");var k="xlate:"+config.lang+":"+config.version;window.__XLATE__={lang:config.lang,map:{}};try{var cached=localStorage.getItem(k);if(cached){var bundle=JSON.parse(cached);window.__XLATE__.map=bundle,run(bundle)}fetch(config.bundleurl,{credentials:"same-origin"}).then((function(r){return r.json()})).then((function(bundle){try{localStorage.setItem(k,JSON.stringify(bundle))}catch(e){}return cached||(window.__XLATE__.map=bundle,run(bundle)),!0})).catch((function(){cached||run({})}))}catch(e){fetch(config.bundleurl).then((function(r){return r.json()})).then((function(bundle){return window.__XLATE__.map=bundle,run(bundle),!0})).catch((function(){run({})}))}},setAutoDetect:function(enabled){autoDetectEnabled=enabled}}}));

//# sourceMappingURL=translator.min.js.map