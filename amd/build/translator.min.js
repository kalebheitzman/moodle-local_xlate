define("local_xlate/translator",["core/ajax"],(function(Ajax){var autoDetectEnabled=!0,detectedStrings=new Set,processedElements=new WeakSet;function translateNode(node,map){if(1===node.nodeType){var key=node.getAttribute&&node.getAttribute("data-xlate");key&&map[key]&&(node.textContent=map[key]),["placeholder","title","alt","aria-label"].forEach((function(attr){var akey=node.getAttribute&&node.getAttribute("data-xlate-"+attr);akey&&map[akey]&&node.setAttribute(attr,map[akey])}))}}function isTranslatableText(text){if(!text||text.length<3)return!1;if((text.match(/[a-zA-Z]/g)||[]).length<.5*text.length)return!1;for(var skipPatterns=[/^\d+[\s\d]*$/,/^[A-Z]{2,}$/,/^[a-z_]+$/,/^\w+\.\w+/,/^https?:/,/^\/\w+/,/^\{[^}]+\}$/,/^\[[^\]]+\]$/,/^<[^>]+>$/],i=0;i<skipPatterns.length;i++)if(skipPatterns[i].test(text.trim()))return!1;return!["ok","id","url","api","css","js","html","php"].includes(text.toLowerCase().trim())}function autoDetectString(element,text,type){if(autoDetectEnabled&&text&&!(text.length<2)){var uniqueId=text+":"+type+":"+element.tagName;if(!detectedStrings.has(uniqueId)){detectedStrings.add(uniqueId);var component=function(element){var container=element.closest("[data-region]");if(container){var region=container.getAttribute("data-region");if(region)return"region_"+region}if(container=element.closest(".block")){var blockClass=container.className.match(/block_(\w+)/);if(blockClass)return"block_"+blockClass[1]}if(container=element.closest(".activity")){var activityClass=container.className.match(/modtype_(\w+)/);if(activityClass)return"mod_"+activityClass[1]}return document.body.classList.contains("path-admin")?"admin":"core"}(element),key=function(element,text,type){var tagName=element.tagName.toLowerCase(),keyParts=[];"placeholder"===type?keyParts.push("Input"):["h1","h2","h3","h4","h5","h6"].includes(tagName)?keyParts.push("Heading"):"button"===tagName||"input"===tagName&&"submit"===element.type?keyParts.push("Button"):"a"===tagName?keyParts.push("Link"):"label"===tagName?keyParts.push("Label"):"alt"===type?keyParts.push("Image"):"title"===type&&keyParts.push("Title");var cleanText=text.replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim().split(" ").map((function(word){return word.charAt(0).toUpperCase()+word.slice(1).toLowerCase()})).join("");return cleanText?keyParts.push(cleanText):keyParts.push("Text"),type&&"text"!==type&&keyParts.push(type.charAt(0).toUpperCase()+type.slice(1)),keyParts.join(".")}(element,text,type);Ajax.call([{methodname:"local_xlate_save_key",args:{component:component,key:key,source:text,lang:M.cfg.language||"en",translation:text}}])[0].then((function(){var attrName="data-xlate"+("text"!==type?"-"+type:"");return element.setAttribute(attrName,key),window.__XLATE__&&window.__XLATE__.map&&(window.__XLATE__.map[key]=text),!0})).catch((function(){detectedStrings.delete(uniqueId)}))}}}function autoDetectElement(element){if(!function(element){var tagName=element.tagName.toLowerCase();if(["script","style","meta","link","noscript","head"].includes(tagName))return!0;if(element.hasAttribute("data-xlate-ignore")||element.closest("[data-xlate-ignore]"))return!0;if(element.hasAttribute("data-xlate")||element.hasAttribute("data-xlate-placeholder")||element.hasAttribute("data-xlate-title")||element.hasAttribute("data-xlate-alt"))return!0;for(var currentPath=window.location.pathname,adminPaths=["/admin/","/local/xlate/","/course/modedit.php","/grade/edit/","/backup/","/restore/","/user/editadvanced.php"],p=0;p<adminPaths.length;p++)if(currentPath.includes(adminPaths[p]))return!0;for(var adminSelectors=[".navbar",".navigation",".breadcrumb",".nav",".admin-menu",".settings-menu",".user-menu",".page-header-headings",".page-context-header",".activity-navigation",".course-content-header",".block_settings",".block_navigation","#page-navbar","#nav-drawer",".drawer",".form-autocomplete-suggestions",".popover",".tooltip",".dropdown-menu"],i=0;i<adminSelectors.length;i++)if(element.closest(adminSelectors[i]))return!0;for(var adminClasses=["editing","editor","admin-only","teacher-only","form-control","btn-secondary","btn-outline","text-muted","small","sr-only","accesshide"],elementClasses=(element.className||"").split(" "),j=0;j<adminClasses.length;j++)if(elementClasses.includes(adminClasses[j]))return!0;var text=element.textContent.trim();if(text.length<3)return!0;var lowerText=text.toLowerCase();return!!["edit","delete","save","cancel","ok","yes","no","settings","config","admin","manage","update","hide","show","move","copy","options","actions"].includes(lowerText)}(element)&&!processedElements.has(element)){processedElements.add(element);var textContent=function(element){var text="";if(0===element.children.length)text=element.textContent.trim();else{for(var simpleFormatting=!0,children=element.children,i=0;i<children.length;i++){var tagName=children[i].tagName.toLowerCase();if(!["b","i","em","strong","span","small"].includes(tagName)){simpleFormatting=!1;break}}simpleFormatting&&(text=element.textContent.trim())}return text.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"").replace(/['"]/g,"'")}(element);if(textContent&&isTranslatableText(textContent)&&autoDetectString(element,textContent,"text"),element.hasAttribute("placeholder")){var placeholder=element.getAttribute("placeholder").trim();placeholder&&isTranslatableText(placeholder)&&autoDetectString(element,placeholder,"placeholder")}if(element.hasAttribute("title")){var title=element.getAttribute("title").trim();title&&isTranslatableText(title)&&autoDetectString(element,title,"title")}if(element.hasAttribute("alt")){var alt=element.getAttribute("alt").trim();alt&&isTranslatableText(alt)&&autoDetectString(element,alt,"alt")}}}function walk(root,map){for(var stack=[root];stack.length;){var el=stack.pop();if(1===el.nodeType){if(el.hasAttribute&&el.hasAttribute("data-xlate-ignore"))continue;translateNode(el,map),autoDetectEnabled&&autoDetectElement(el);for(var children=el.children||[],i=0;i<children.length;i++)stack.push(children[i])}}}function run(map){try{walk(document.body,map||{}),autoDetectEnabled&&setTimeout((function(){walk(document.body,map||{})}),1e3),new MutationObserver((function(muts){muts.forEach((function(m){(m.addedNodes||[]).forEach((function(n){1===n.nodeType&&walk(n,map||{})}))}))})).observe(document.body,{childList:!0,subtree:!0})}finally{document.documentElement.classList.remove("xlate-loading")}}return{run:run,init:function(config){document.documentElement.classList.add("xlate-loading");var k="xlate:"+config.lang+":"+config.version;window.__XLATE__={lang:config.lang,map:{}};try{var cached=localStorage.getItem(k);if(cached){var bundle=JSON.parse(cached);window.__XLATE__.map=bundle,run(bundle)}fetch(config.bundleurl,{credentials:"same-origin"}).then((function(r){return r.json()})).then((function(bundle){try{localStorage.setItem(k,JSON.stringify(bundle))}catch(e){}return cached||(window.__XLATE__.map=bundle,run(bundle)),!0})).catch((function(){cached||run({})}))}catch(e){fetch(config.bundleurl).then((function(r){return r.json()})).then((function(bundle){return window.__XLATE__.map=bundle,run(bundle),!0})).catch((function(){run({})}))}},setAutoDetect:function(enabled){autoDetectEnabled=enabled}}}));

//# sourceMappingURL=translator.min.js.map