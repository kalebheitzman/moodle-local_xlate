{"version":3,"file":"translator_old.min.js","sources":["../src/translator_old.js"],"sourcesContent":["// Local/xlate/amd/src/translator.js\n// Handles DOM translation and automatic key capture with structural-based keys.\ndefine(['core/ajax'], function (Ajax) {\n  var ATTR_KEY_PREFIX = 'data-xlate-key-';\n  var ATTRIBUTE_TYPES = ['placeholder', 'title', 'alt', 'aria-label'];\n\n  var autoDetectEnabled = true;\n  var detectedStrings = new Set();\n  var processedElements = new WeakSet();\n  var lastProcessTime = 0;\n  var processThrottle = 250; // Minimum ms between full DOM scans\n\n/**\n   * Set the appropriate key attribute on an element.\n   * @param {Element} element\n   * @param {string} type\n   * @param {string} key\n   */\n  function setKeyAttribute(element, type, key) {\n    if (!element || !key) {\n      return;\n    }\n\n    // Always use data-xlate-key-{type} format for consistency\n    var attrType = type === 'text' ? 'content' : type;\n    element.setAttribute(ATTR_KEY_PREFIX + attrType, key);\n  }\n\n  /**\n   * Retrieve an existing key attribute from the element.\n   * @param {Element} element\n   * @param {string} type\n   * @returns {string|null}\n   */\n  function getKeyFromAttributes(element, type) {\n    if (!element) {\n      return null;\n    }\n\n    var attrType = type === 'text' ? 'content' : type;\n    return element.getAttribute(ATTR_KEY_PREFIX + attrType);\n  }\n\n  /**\n   * Translate a single element when metadata is present.\n   * @param {Element} node DOM node to translate.\n   * @param {Object<string, string>} map Translation map.\n   * @returns {void}\n   */\n  function translateNode(node, map) {\n    if (!node || node.nodeType !== 1) {\n      return;\n    }\n\n    var key = getKeyFromAttributes(node, 'text');\n    if (key && map[key]) {\n      node.textContent = map[key];\n      setKeyAttribute(node, 'text', key); // Ensure key is visible in DOM\n    } else if (node.childNodes.length === 1 && node.childNodes[0].nodeType === 3) {\n      var textContent = node.textContent.trim();\n      var normalized = normalizeTextForKey(textContent);\n      if (normalized && window.__XLATE__ && window.__XLATE__.sourceMap) {\n        var translationKey = window.__XLATE__.sourceMap[normalized];\n        if (translationKey && map[translationKey]) {\n          setKeyAttribute(node, 'text', translationKey); // Inject key before translation\n          node.textContent = map[translationKey];\n        }\n      }\n    }\n\n    ATTRIBUTE_TYPES.forEach(function (attr) {\n      var attrKey = getKeyFromAttributes(node, attr);\n      if (attrKey && map[attrKey]) {\n        node.setAttribute(attr, map[attrKey]);\n        setKeyAttribute(node, attr, attrKey); // Ensure key is visible in DOM\n        return;\n      }\n\n      var value = node.getAttribute && node.getAttribute(attr);\n      if (!value) {\n        return;\n      }\n\n      var normalisedAttr = normalizeTextForKey(value);\n      if (normalisedAttr && window.__XLATE__ && window.__XLATE__.sourceMap) {\n        var attrTranslationKey = window.__XLATE__.sourceMap[normalisedAttr];\n        if (attrTranslationKey && map[attrTranslationKey]) {\n          node.setAttribute(attr, map[attrTranslationKey]);\n          setKeyAttribute(node, attr, attrTranslationKey); // Inject key before translation\n        }\n      }\n    });\n  }\n\n  /**\n   * Check if element should be ignored for auto-detection\n   * @param {Element} element - Element to check\n   * @returns {boolean} True if should be ignored\n   */\n  function shouldIgnoreElement(element) {\n    if (!element || !element.tagName) {\n      return true;\n    }\n\n    var tagName = element.tagName.toLowerCase();\n\n    if (['script', 'style', 'meta', 'link', 'noscript', 'head'].indexOf(tagName) !== -1) {\n      return true;\n    }\n\n    if (element.hasAttribute('data-xlate-ignore') || element.closest('[data-xlate-ignore]')) {\n      return true;\n    }\n\n    // Check for content key (text content)\n    if (element.hasAttribute(ATTR_KEY_PREFIX + 'content') ||\n      element.hasAttribute(LEGACY_ATTR_PREFIX + 'content')) {\n      return true;\n    }\n\n    // Check for attribute keys\n    for (var i = 0; i < ATTRIBUTE_TYPES.length; i++) {\n      if (element.hasAttribute(ATTR_KEY_PREFIX + ATTRIBUTE_TYPES[i]) ||\n        element.hasAttribute(LEGACY_ATTR_PREFIX + ATTRIBUTE_TYPES[i])) {\n        return true;\n      }\n    }\n\n    var currentPath = window.location.pathname || '';\n    var adminPaths = [\n      '/admin/',\n      '/local/xlate/',\n      '/course/modedit.php',\n      '/grade/edit/',\n      '/backup/',\n      '/restore/',\n      '/user/editadvanced.php'\n    ];\n\n    for (var p = 0; p < adminPaths.length; p++) {\n      if (currentPath.indexOf(adminPaths[p]) === 0) {\n        return true;\n      }\n    }\n\n    var adminSelectors = [\n      '.navbar', '.navigation', '.breadcrumb', '.nav',\n      '.admin-menu', '.settings-menu', '.user-menu',\n      '.page-header-headings', '.page-context-header',\n      '.activity-navigation', '.course-content-header',\n      '.block_settings', '.block_navigation',\n      '#page-navbar', '#nav-drawer', '.drawer',\n      '.form-autocomplete-suggestions', '.popover',\n      '.tooltip', '.dropdown-menu'\n    ];\n\n    for (var iSel = 0; iSel < adminSelectors.length; iSel++) {\n      if (element.closest(adminSelectors[iSel])) {\n        return true;\n      }\n    }\n\n    var adminClasses = [\n      'editing', 'editor', 'admin-only', 'teacher-only',\n      'form-control', 'btn-secondary', 'btn-outline',\n      'text-muted', 'small', 'sr-only', 'accesshide'\n    ];\n\n    var elementClasses = (element.className || '').split(' ');\n    for (var j = 0; j < adminClasses.length; j++) {\n      if (elementClasses.indexOf(adminClasses[j]) !== -1) {\n        return true;\n      }\n    }\n\n    var text = element.textContent ? element.textContent.trim() : '';\n    if (text.length < 3) {\n      return true;\n    }\n\n    var adminWords = [\n      'edit', 'delete', 'save', 'cancel', 'ok', 'yes', 'no',\n      'settings', 'config', 'admin', 'manage', 'update',\n      'hide', 'show', 'move', 'copy', 'options', 'actions'\n    ];\n\n    if (adminWords.indexOf(text.toLowerCase()) !== -1) {\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Check if text content is worth translating\n   * @param {string} text - Text to analyze\n   * @returns {boolean} True if should be translated\n   */\n  function isTranslatableText(text) {\n    if (!text || text.length < 3) {\n      return false;\n    }\n\n    var normalized = normalizeTextForKey(text);\n    if (!normalized) {\n      return false;\n    }\n\n    var alphaCount = (normalized.match(/[a-zA-Z\\p{L}]/gu) || []).length;\n    if (alphaCount < normalized.length * 0.5) {\n      return false;\n    }\n\n    var commonWords = ['ok', 'id', 'url', 'api', 'css', 'js', 'html', 'php'];\n    if (commonWords.indexOf(normalized) !== -1) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Extract clean text from element, handling simple HTML\n   * @param {Element} element - Element to extract text from\n   * @returns {string}\n   */\n  function extractCleanText(element) {\n    if (!element) {\n      return '';\n    }\n\n    if (element.children.length === 0) {\n      return element.textContent.trim();\n    }\n\n    var simpleFormatting = true;\n    var children = element.children;\n    for (var i = 0; i < children.length; i++) {\n      var tagName = children[i].tagName.toLowerCase();\n      if (['b', 'i', 'em', 'strong', 'span', 'small'].indexOf(tagName) === -1) {\n        simpleFormatting = false;\n        break;\n      }\n    }\n\n    if (simpleFormatting) {\n      return element.textContent.trim();\n    }\n\n    return '';\n  }\n\n  /**\n   * Generate component name from element context\n   * @param {Element} element - Element to analyze\n   * @returns {string} Component name\n   */\n  function detectComponent(element) {\n    if (!element) {\n      return 'core';\n    }\n\n    var container = element.closest('[data-region]');\n    if (container) {\n      var region = container.getAttribute('data-region');\n      if (region) {\n        return 'region_' + region;\n      }\n    }\n\n    container = element.closest('.block');\n    if (container) {\n      var blockClass = container.className.match(/block_(\\w+)/);\n      if (blockClass) {\n        return 'block_' + blockClass[1];\n      }\n    }\n\n    container = element.closest('.activity');\n    if (container) {\n      var activityClass = container.className.match(/modtype_(\\w+)/);\n      if (activityClass) {\n        return 'mod_' + activityClass[1];\n      }\n    }\n\n    if (document.body.classList.contains('path-admin')) {\n      return 'admin';\n    }\n\n    return 'core';\n  }\n\n  /**\n   * Collect meaningful class names from element (filtering dynamic/utility classes)\n   * @param {Element} element - Element to extract classes from\n   * @returns {string} Comma-separated class names\n   */\n  function collectContextClasses(element) {\n    if (!element) {\n      return '';\n    }\n\n    var blacklist = ['active', 'show', 'hide', 'hidden', 'collapsed', 'expanded', 'selected', 'current',\n      'focus', 'open', 'close', 'tooltip', 'dropdown', 'modal', 'd-flex', 'd-none', 'd-block',\n      'mt-1', 'mt-2', 'mt-3', 'mt-4', 'mt-5', 'mb-1', 'mb-2', 'mb-3', 'mb-4', 'mb-5',\n      'ml-1', 'ml-2', 'ml-3', 'ml-4', 'ml-5', 'mr-1', 'mr-2', 'mr-3', 'mr-4', 'mr-5',\n      'p-1', 'p-2', 'p-3', 'p-4', 'p-5', 'sr-only', 'visually-hidden'];\n\n    var classes = [];\n    if (element.classList) {\n      var classList = Array.prototype.slice.call(element.classList);\n      classList.forEach(function (cls) {\n        if (cls && cls.length > 2 && blacklist.indexOf(cls) === -1 &&\n          !/^[0-9]/.test(cls) && classes.indexOf(cls) === -1) {\n          classes.push(cls);\n        }\n      });\n    }\n\n    return classes.join(',');\n  }\n\n  /**\n   * Collect all data-* attributes from an element\n   * @param {Element} element - Element to extract data attributes from\n   * @returns {string} Concatenated data attribute values\n   */\n  function collectDataAttributes(element) {\n    if (!element || !element.attributes) {\n      return '';\n    }\n\n    var dataAttrs = [];\n    for (var i = 0; i < element.attributes.length; i++) {\n      var attr = element.attributes[i];\n      if (attr.name.indexOf('data-') === 0 && attr.value) {\n        // Skip data-xlate-* attributes to avoid circular references\n        if (attr.name.indexOf('data-xlate') !== 0) {\n          dataAttrs.push(attr.value);\n        }\n      }\n    }\n\n    return dataAttrs.join(',');\n  }\n\n  /**\n   * Simple hash function to create consistent 12-character keys\n   * @param {string} str - String to hash\n   * @returns {string} 12-character hash\n   */\n  function simpleHash(str) {\n    var hash = 0;\n    for (var i = 0; i < str.length; i++) {\n      var char = str.charCodeAt(i);\n      hash = ((hash << 5) - hash) + char;\n      hash = hash & hash; // Convert to 32-bit integer\n    }\n\n    // Convert to base36 and pad/truncate to 12 chars\n    var hashStr = Math.abs(hash).toString(36);\n    if (hashStr.length < 12) {\n      hashStr = (hashStr + '000000000000').substring(0, 12);\n    } else {\n      hashStr = hashStr.substring(0, 12);\n    }\n\n    return hashStr;\n  }\n\n  /**\n   * Generate translation key from element content and context\n   * @param {Element} element - Element to generate key for\n   * @param {string} text - Text content\n   * @param {string} type - Type of content (text, placeholder, title, alt)\n   * @returns {string} Generated key (12-character hash)\n   */\n  function generateKey(element, text, type) {\n    if (!element || !text) {\n      return '';\n    }\n\n    var parts = [];\n\n    // Get parent context (one level up)\n    var parent = element.parentElement;\n    if (parent && parent.tagName) {\n      parts.push(parent.tagName.toLowerCase());\n      var parentClasses = collectContextClasses(parent);\n      if (parentClasses) {\n        parts.push(parentClasses);\n      }\n      var parentData = collectDataAttributes(parent);\n      if (parentData) {\n        parts.push(parentData);\n      }\n    }\n\n    // Get current element context\n    var tagName = element.tagName ? element.tagName.toLowerCase() : '';\n    if (tagName) {\n      parts.push(tagName);\n    }\n\n    var classes = collectContextClasses(element);\n    if (classes) {\n      parts.push(classes);\n    }\n\n    var dataAttrs = collectDataAttributes(element);\n    if (dataAttrs) {\n      parts.push(dataAttrs);\n    }\n\n    // Add type if not text\n    if (type && type !== 'text') {\n      parts.push(type);\n    }\n\n    // Add the text content\n    parts.push(text);\n\n    // Create composite string and hash it\n    var composite = parts.join('.');\n    return simpleHash(composite);\n  }\n\n  /**\n   * Auto-detect and save translatable string\n   * @param {Element} element - Element containing the string\n   * @param {string} text - Text content to save\n   * @param {string} type - Type of content (text, placeholder, title, alt)\n   */\n  function autoDetectString(element, text, type) {\n    if (!autoDetectEnabled || !text) {\n      return;\n    }\n\n    var fingerprint = createTextFingerprint(text);\n    if (!fingerprint.normalized) {\n      return;\n    }\n\n    var component = detectComponent(element);\n    var dedupeKey = component + ':' + fingerprint.normalized + ':' + type;\n    if (detectedStrings.has(dedupeKey)) {\n      return;\n    }\n    detectedStrings.add(dedupeKey);\n\n    var key = generateKey(element, text, type);\n    if (!key) {\n      return;\n    }\n\n    Ajax.call([{\n      methodname: 'local_xlate_save_key',\n      args: {\n        component: component,\n        key: key,\n        source: text,\n        lang: (window.__XLATE__ && window.__XLATE__.lang) || M.cfg.language || 'en',\n        translation: text\n      }\n    }])[0].then(function () {\n      setKeyAttribute(element, type, key);\n\n      if (window.__XLATE__) {\n        if (!window.__XLATE__.map) {\n          window.__XLATE__.map = {};\n        }\n        if (!window.__XLATE__.sourceMap) {\n          window.__XLATE__.sourceMap = {};\n        }\n        window.__XLATE__.map[key] = text;\n        window.__XLATE__.sourceMap[fingerprint.normalized] = key;\n      }\n\n      return true;\n    }).catch(function () {\n      detectedStrings.delete(dedupeKey);\n    });\n  }\n\n  /**\n   * Auto-detect translatable content in an element\n   * @param {Element} element - Element to analyze\n   */\n  function autoDetectElement(element) {\n    if (!autoDetectEnabled || !element) {\n      return;\n    }\n\n    if (shouldIgnoreElement(element)) {\n      return;\n    }\n\n    var currentLang = (window.__XLATE__ && window.__XLATE__.lang) || M.cfg.language || 'en';\n    var siteLang = (window.__XLATE__ && window.__XLATE__.siteLang) || 'en';\n\n    if (currentLang !== siteLang) {\n      return;\n    }\n\n    if (processedElements.has(element)) {\n      return;\n    }\n    processedElements.add(element);\n\n    var textContent = extractCleanText(element);\n    if (textContent && isTranslatableText(textContent)) {\n      autoDetectString(element, textContent, 'text');\n    }\n\n    ATTRIBUTE_TYPES.forEach(function (attr) {\n      if (!element.hasAttribute(attr)) {\n        return;\n      }\n      var value = element.getAttribute(attr).trim();\n      if (value && isTranslatableText(value)) {\n        autoDetectString(element, value, attr);\n      }\n    });\n  }\n\n  /**\n   * Walk the DOM depth-first and translate every eligible child.\n   * @param {Element} root Root element to process.\n   * @param {Object<string, string>} map Translation map.\n   * @returns {void}\n   */\n  function walk(root, map) {\n    if (!root) {\n      return;\n    }\n\n    var stack = [root];\n    while (stack.length) {\n      var el = stack.pop();\n      if (el.nodeType === 1) {\n        if (el.hasAttribute && el.hasAttribute('data-xlate-ignore')) {\n          continue;\n        }\n\n        translateNode(el, map);\n\n        if (autoDetectEnabled) {\n          autoDetectElement(el);\n        }\n\n        var children = el.children || [];\n        for (var i = 0; i < children.length; i++) {\n          stack.push(children[i]);\n        }\n      }\n    }\n  }\n\n  /**\n   * Entry point: translates current DOM and observes future updates.\n   * @param {Object<string, string>} map Translation map.\n   * @returns {void}\n   */\n  function run(map) {\n    try {\n      walk(document.body, map || {});\n\n      if (autoDetectEnabled) {\n        setTimeout(function () {\n          walk(document.body, map || {});\n        }, 1000);\n\n        setTimeout(function () {\n          walk(document.body, map || {});\n        }, 3000);\n      }\n\n      var mo = new MutationObserver(function (muts) {\n        muts.forEach(function (mutation) {\n          Array.prototype.slice.call(mutation.addedNodes || []).forEach(function (node) {\n            if (node.nodeType === 1) {\n              walk(node, map || {});\n              if (node.querySelectorAll) {\n                Array.prototype.forEach.call(node.querySelectorAll('*'), function (child) {\n                  walk(child, map || {});\n                });\n              }\n            }\n          });\n        });\n      });\n      mo.observe(document.body, { childList: true, subtree: true });\n\n      if (typeof window.addEventListener === 'function') {\n        document.addEventListener('DOMContentLoaded', function () {\n          setTimeout(function () {\n            walk(document.body, map || {});\n          }, 2000);\n        });\n\n        ['focus', 'click', 'scroll'].forEach(function (eventType) {\n          document.addEventListener(eventType, function () {\n            var now = Date.now();\n            if (now - lastProcessTime > processThrottle) {\n              lastProcessTime = now;\n              setTimeout(function () {\n                walk(document.body, map || {});\n              }, 100);\n            }\n          }, true);\n        });\n      }\n    } finally {\n      document.documentElement.classList.remove('xlate-loading');\n    }\n  }\n\n  /**\n   * Initialize the translator with config from Moodle.\n   * @param {Object} config Configuration object with lang, version, bundleurl.\n   * @returns {void}\n   */\n  function init(config) {\n    document.documentElement.classList.add('xlate-loading');\n\n    if (typeof config.autodetect !== 'undefined') {\n      setAutoDetect(!(config.autodetect === false || config.autodetect === 'false'));\n    }\n\n    var k = 'xlate:' + config.lang + ':' + config.version;\n\n    window.__XLATE__ = {\n      lang: config.lang,\n      siteLang: config.siteLang,\n      map: {},\n      sourceMap: {}\n    };\n\n    /**\n     * Apply bundle data (cached or fresh) to the runtime, then translate if needed.\n     * @param {Object} bundleData Translation payload from the server/cache.\n     * @param {boolean} cached Indicates whether the payload came from localStorage.\n     * @returns {void}\n     */\n    function processBundle(bundleData, cached) {\n      if (!bundleData) {\n        return;\n      }\n\n      if (bundleData.translations) {\n        window.__XLATE__.map = bundleData.translations;\n        window.__XLATE__.sourceMap = bundleData.sourceMap || {};\n        if (!cached) {\n          run(bundleData.translations);\n        }\n      } else {\n        window.__XLATE__.map = bundleData;\n        window.__XLATE__.sourceMap = bundleData.sourceMap || {};\n        if (!cached) {\n          run(bundleData);\n        }\n      }\n    }\n\n    try {\n      var cached = localStorage.getItem(k);\n      if (cached) {\n        processBundle(JSON.parse(cached), true);\n      }\n\n      fetch(config.bundleurl, { credentials: 'same-origin' })\n        .then(function (response) {\n          return response.json();\n        })\n        .then(function (bundleData) {\n          try {\n            localStorage.setItem(k, JSON.stringify(bundleData));\n          } catch (err) {\n            // Ignore storage errors (quota, etc.)\n          }\n\n          processBundle(bundleData, false);\n          return true;\n        })\n        .catch(function () {\n          if (!cached) {\n            run({});\n          }\n        });\n    } catch (err) {\n      fetch(config.bundleurl)\n        .then(function (response) {\n          return response.json();\n        })\n        .then(function (bundle) {\n          processBundle(bundle, false);\n          return true;\n        })\n        .catch(function () {\n          run({});\n        });\n    }\n  }\n\n  /**\n   * Enable or disable automatic string detection\n   * @param {boolean} enabled - Whether to enable auto-detection\n   */\n  function setAutoDetect(enabled) {\n    autoDetectEnabled = !!enabled;\n  }\n\n  return {\n    run: run,\n    init: init,\n    setAutoDetect: setAutoDetect\n  };\n});\n"],"names":["define","Ajax","ATTRIBUTE_TYPES","autoDetectEnabled","detectedStrings","Set","processedElements","WeakSet","lastProcessTime","setKeyAttribute","element","type","key","attrType","setAttribute","getKeyFromAttributes","getAttribute","translateNode","node","map","nodeType","textContent","childNodes","length","trim","normalized","normalizeTextForKey","window","__XLATE__","sourceMap","translationKey","forEach","attr","attrKey","value","normalisedAttr","attrTranslationKey","isTranslatableText","text","match","indexOf","collectContextClasses","blacklist","classes","classList","Array","prototype","slice","call","cls","test","push","join","collectDataAttributes","attributes","dataAttrs","i","name","generateKey","parts","parent","parentElement","tagName","toLowerCase","parentClasses","parentData","str","hash","charCodeAt","hashStr","Math","abs","toString","substring","simpleHash","autoDetectString","fingerprint","createTextFingerprint","component","container","closest","region","blockClass","className","activityClass","document","body","contains","detectComponent","dedupeKey","has","add","methodname","args","source","lang","M","cfg","language","translation","then","catch","delete","autoDetectElement","hasAttribute","ATTR_KEY_PREFIX","LEGACY_ATTR_PREFIX","currentPath","location","pathname","adminPaths","p","adminSelectors","iSel","adminClasses","elementClasses","split","j","shouldIgnoreElement","siteLang","children","simpleFormatting","extractCleanText","walk","root","stack","el","pop","run","setTimeout","MutationObserver","muts","mutation","addedNodes","querySelectorAll","child","observe","childList","subtree","addEventListener","eventType","now","Date","documentElement","remove","setAutoDetect","enabled","init","config","autodetect","k","version","processBundle","bundleData","cached","translations","localStorage","getItem","JSON","parse","fetch","bundleurl","credentials","response","json","setItem","stringify","err","bundle"],"mappings":"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"}