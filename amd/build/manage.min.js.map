{"version":3,"file":"manage.min.js","sources":["../src/manage.js"],"sourcesContent":["// AMD module for the Manage UI (autotranslate controls + inline actions).\n/**\n * Manage UI helper for the Admin page.\n *\n * Handles per-entry delete actions, course-level autotranslate submission,\n * and progress polling for in-flight jobs.\n */\ndefine(['core/ajax', 'core/notification'], function (Ajax, notification) {\n    /**\n     * Resolve a UI string from the AMD config or return a fallback.\n     *\n     * @param {Object} config Module configuration payload.\n     * @param {string} key String key under config.strings.\n     * @param {string} fallback Default text when missing.\n     * @returns {string} Localised string.\n     */\n    function getString(config, key, fallback) {\n        if (config && config.strings && config.strings[key]) {\n            return config.strings[key];\n        }\n        return fallback;\n    }\n\n    /**\n     * Find the closest form ancestor for an element (with IE fallback).\n     *\n     * @param {HTMLElement} element Origin element.\n     * @returns {HTMLFormElement|null} Resolved form element.\n     */\n    function findParentForm(element) {\n        if (!element) {\n            return null;\n        }\n        if (typeof element.closest === 'function') {\n            return element.closest('form');\n        }\n        var node = element;\n        while (node && node.tagName && node.tagName.toLowerCase() !== 'form') {\n            node = node.parentNode;\n        }\n        if (node && node.tagName && node.tagName.toLowerCase() === 'form') {\n            return node;\n        }\n        return null;\n    }\n\n    /**\n     * Clear translation input/checkbox fields tied to a delete button.\n     *\n     * @param {HTMLElement} button Delete button element.\n     * @returns {void}\n     */\n    function clearTranslationFields(button) {\n        if (!button) {\n            return;\n        }\n        var form = findParentForm(button);\n        if (!form) {\n            return;\n        }\n        var field = form.querySelector('[name=\"translation\"]');\n        if (field) {\n            field.value = '';\n        }\n        var toggles = form.querySelectorAll('input[name=\"status\"], input[name=\"reviewed\"]');\n        if (toggles && toggles.length) {\n            Array.prototype.forEach.call(toggles, function (toggle) {\n                toggle.checked = false;\n            });\n        }\n    }\n\n    /**\n     * Invoke the delete translation web service for a button context.\n     *\n     * @param {HTMLElement} button Button initiating the delete request.\n     * @param {Object} config Module configuration.\n     * @returns {void}\n     */\n    function deleteTranslation(button, config) {\n        if (!button) {\n            return;\n        }\n        var keyid = parseInt(button.getAttribute('data-keyid'), 10) || 0;\n        var lang = button.getAttribute('data-lang') || '';\n        if (!keyid || !lang) {\n            return;\n        }\n\n        var failureMessage = getString(config, 'deleteFailed', 'Unable to delete translation.');\n        var successMessage = getString(config, 'deleteSuccess', 'Translation deleted.');\n\n        button.disabled = true;\n\n        var request = Ajax.call([{\n            methodname: 'local_xlate_delete_translation',\n            args: {\n                keyid: keyid,\n                lang: lang\n            }\n        }])[0];\n\n        request.then(function (res) {\n            if (res && res.success) {\n                clearTranslationFields(button);\n                notification.addNotification({\n                    message: successMessage,\n                    type: 'success'\n                });\n            } else {\n                notification.alert(failureMessage);\n            }\n            button.disabled = false;\n        }).catch(function (err) {\n            var msg = failureMessage;\n            if (err && err.message) {\n                msg += '\\n' + err.message;\n            } else if (err && err.error) {\n                msg += '\\n' + err.error;\n            }\n            notification.alert(msg);\n            button.disabled = false;\n        });\n    }\n\n    /**\n     * Swap button text for a spinner while an action is running.\n     *\n     * @param {HTMLButtonElement} button Target button.\n     * @param {boolean} loading Whether to show loading state.\n     * @returns {void}\n     */\n    function toggleButtonLoading(button, loading) {\n        if (!button) {\n            return;\n        }\n        var isIconButton = button.classList && button.classList.contains('js-xlate-icon-button');\n        if (loading) {\n            if (!button.dataset.originalHtml) {\n                button.dataset.originalHtml = button.innerHTML;\n                if (!isIconButton) {\n                    var labelText = '';\n                    if (button.textContent) {\n                        labelText = button.textContent.trim();\n                    }\n                    if (!labelText && button.getAttribute('aria-label')) {\n                        labelText = button.getAttribute('aria-label');\n                    }\n                    button.dataset.originalLabel = labelText || 'Autotranslate';\n                }\n            }\n            button.disabled = true;\n            if (isIconButton) {\n                button.innerHTML = '<span class=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span>';\n            } else {\n                var label = button.dataset.originalLabel || '';\n                var spinner = '' +\n                    '<span class=\"spinner-border spinner-border-sm me-1\" role=\"status\" aria-hidden=\"true\"></span>';\n                button.innerHTML = spinner + label;\n            }\n        } else {\n            if (button.dataset.originalHtml) {\n                button.innerHTML = button.dataset.originalHtml;\n                delete button.dataset.originalHtml;\n            }\n            if (button.dataset.originalLabel) {\n                delete button.dataset.originalLabel;\n            }\n            button.disabled = false;\n        }\n    }\n\n    /**\n     * Request an inline autotranslation for the button's key/language pair.\n     *\n     * @param {HTMLButtonElement} button Autotranslate button element.\n     * @param {Object} config Module configuration.\n     * @returns {void}\n     */\n    function requestAutotranslation(button, config) {\n        if (!button) {\n            return;\n        }\n        var keyid = parseInt(button.getAttribute('data-keyid'), 10) || 0;\n        var targetlang = button.getAttribute('data-lang') || '';\n        if (!keyid || !targetlang) {\n            return;\n        }\n        var form = findParentForm(button);\n        var textarea = form ? form.querySelector('[name=\"translation\"]') : null;\n        var statusToggle = form ? form.querySelector('input[name=\"status\"]') : null;\n        var reviewedToggle = form ? form.querySelector('input[name=\"reviewed\"]') : null;\n\n        var args = {\n            keyid: keyid,\n            targetlang: targetlang,\n            autosave: true\n        };\n        var courseid = (config && config.courseid) ? parseInt(config.courseid, 10) || 0 : 0;\n        if (courseid > 0) {\n            args.courseid = courseid;\n        }\n\n        toggleButtonLoading(button, true);\n\n        Ajax.call([{\n            methodname: 'local_xlate_autotranslate_key',\n            args: args\n        }])[0].then(function (res) {\n            toggleButtonLoading(button, false);\n            if (!(res && res.success && typeof res.translation === 'string')) {\n                var failureMessage = getString(config, 'autoTranslateFailed', 'Autotranslate failed.');\n                if (res && res.error) {\n                    failureMessage += '\\n' + res.error;\n                }\n                notification.alert(failureMessage);\n                return;\n            }\n            if (textarea) {\n                textarea.value = res.translation;\n                try {\n                    textarea.dispatchEvent(new Event('input', { bubbles: true }));\n                } catch (e) {\n                    var evt = document.createEvent('Event');\n                    evt.initEvent('input', true, true);\n                    textarea.dispatchEvent(evt);\n                }\n            }\n            if (reviewedToggle) {\n                reviewedToggle.checked = false;\n            }\n            if (statusToggle) {\n                statusToggle.checked = true;\n            }\n            var successKey = res && res.saved ? 'autoTranslateSaved' : 'autoTranslateReady';\n            var successFallback = successKey === 'autoTranslateSaved'\n                ? 'Autotranslation saved and marked active.'\n                : 'Autotranslation inserted. Review and save.';\n            var successMessage = getString(config, successKey, successFallback);\n            notification.addNotification({\n                message: successMessage,\n                type: 'success'\n            });\n        }).catch(function (err) {\n            toggleButtonLoading(button, false);\n            var failureMessage = getString(config, 'autoTranslateFailed', 'Autotranslate failed.');\n            if (err && err.message) {\n                failureMessage += '\\n' + err.message;\n            } else if (err && err.error) {\n                failureMessage += '\\n' + err.error;\n            }\n            notification.alert(failureMessage);\n        });\n    }\n\n    /**\n     * Wire up delete buttons to the AJAX workflow.\n     *\n     * @param {Object} config Module configuration payload.\n     * @returns {void}\n     */\n    function attachDeleteHandlers(config) {\n        var buttons = document.querySelectorAll('.js-xlate-delete-translation');\n        if (!buttons || !buttons.length) {\n            return;\n        }\n        var confirmMessage = getString(config, 'confirmDelete', 'Delete this translation?');\n        var confirmTitle = getString(config, 'confirmDeleteTitle', 'Delete translation');\n        var confirmAction = getString(config, 'confirmDeleteAction', 'Confirm');\n        var cancelLabel = getString(config, 'confirmDeleteCancel', 'Cancel');\n        Array.prototype.forEach.call(buttons, function (button) {\n            button.addEventListener('click', function (event) {\n                event.preventDefault();\n                if (button.disabled) {\n                    return;\n                }\n                notification.confirm(\n                    confirmTitle,\n                    confirmMessage,\n                    confirmAction,\n                    cancelLabel,\n                    function () {\n                        deleteTranslation(button, config);\n                    }\n                );\n            });\n        });\n    }\n\n    /**\n     * Wire autotranslate buttons to inline translation requests.\n     *\n     * @param {Object} config Module configuration payload.\n     * @returns {void}\n     */\n    function attachAutoTranslateHandlers(config) {\n        var buttons = document.querySelectorAll('.js-xlate-auto-translate');\n        if (!buttons || !buttons.length) {\n            return;\n        }\n        Array.prototype.forEach.call(buttons, function (button) {\n            button.addEventListener('click', function (event) {\n                event.preventDefault();\n                if (button.disabled) {\n                    return;\n                }\n                requestAutotranslation(button, config);\n            });\n        });\n    }\n\n    /**\n     * Enable Bootstrap tooltips for icon-only action buttons (Boost themes).\n     *\n     * @returns {void}\n     */\n    function enableIconTooltips() {\n        var buttons = document.querySelectorAll('.js-xlate-icon-button[data-bs-toggle=\"tooltip\"]');\n        if (!buttons || !buttons.length || typeof require !== 'function') {\n            return;\n        }\n        require(['theme_boost/bootstrap'], function (Bootstrap) {\n            if (!Bootstrap) {\n                return;\n            }\n            var TooltipCtor = Bootstrap.Tooltip || (Bootstrap.default && Bootstrap.default.Tooltip);\n            if (!TooltipCtor) {\n                return;\n            }\n            Array.prototype.forEach.call(buttons, function (button) {\n                if (!button) {\n                    return;\n                }\n                try {\n                    if (typeof TooltipCtor.getInstance === 'function') {\n                        var instance = TooltipCtor.getInstance(button);\n                        if (instance) {\n                            instance.enable();\n                            return;\n                        }\n                    }\n                    new TooltipCtor(button);\n                } catch (e) {\n                    // Ignore tooltip instantiation errors to keep buttons usable.\n                }\n            });\n        }, function () {\n            // Non-Boost themes may not provide the Bootstrap AMD helper; fail silently.\n        });\n    }\n    return {\n        /**\n         * Initialise the autotranslate UI bindings.\n         *\n         * @param {Object} config Server-provided settings for the Manage page.\n         * @param {number} [config.courseid] Current course filter identifier.\n         * @param {number} [config.currentjobid] Active job to resume polling.\n         * @returns {void}\n         */\n        init: function (config) {\n            attachDeleteHandlers(config);\n            attachAutoTranslateHandlers(config);\n            enableIconTooltips();\n            var courseButton = document.getElementById('local_xlate_autotranslate_course');\n\n            // If the server passed an active job id but the Manage page card or\n            // its elements are not present (for example because the course\n            // filter was lost during navigation), create a small inline\n            // progress container and resume polling so the user still sees\n            // progress for their job.\n            if (config && config.currentjobid && !document.getElementById('local_xlate_course_progress')) {\n                try {\n                    // Append the progress container to the main content area if available,\n                    // otherwise append to document.body.\n                    var parent = document.getElementById('region-main') || document.body;\n                    var wrapper = document.createElement('div');\n                    wrapper.id = 'local_xlate_course_progress_wrapper';\n                    wrapper.style.margin = '12px 0';\n                    wrapper.innerHTML = '' +\n                        '<div id=\"local_xlate_course_progress\" style=\"display:block;\">' +\n                        '<div style=\"font-size:90%; margin-bottom:6px\">' +\n                        '<span id=\"local_xlate_course_job_owner\" style=\"font-weight:600\"></span>' +\n                        '<span id=\"local_xlate_course_job_status\" style=\"margin-left:8px; color:#666\"></span>' +\n                        '<span id=\"local_xlate_course_job_langs\" style=\"float:right; font-size:90%\"></span>' +\n                        '</div>' +\n                        '<div class=\"progress\" role=\"progressbar\" aria-label=\"Autotranslate progress\">' +\n                        // Use Bootstrap striped + animated classes for nicer effect\n                        '<div id=\"local_xlate_course_progress_bar\" class=\"progress-bar progress-bar-striped ' +\n                        'progress-bar-animated bg-info\" style=\"width:0%\" aria-valuemin=\"0\" aria-valuemax=\"100\">0%</div>' +\n                        '</div>' +\n                        '<div id=\"local_xlate_course_progress_text\" style=\"margin-top:6px; font-size:90%\">0 / 0</div>' +\n                        '</div>';\n                    parent.insertBefore(wrapper, parent.firstChild);\n                } catch (e) {\n                    // ignore DOM insertion errors\n                }\n            }\n\n            // If there's no course button (no card), keep going — we still may\n            // need to resume polling for an active job.\n\n            // per-item autotranslate removed — we only support course-level autotranslate now.\n\n            // per-item autotranslate removed — we only support course-level autotranslate now.\n\n            // Course-level autotranslate: enqueue a job for the current course\n            if (courseButton) {\n                courseButton.addEventListener('click', function () {\n                    // Determine course id from config or global window variable\n                    var courseid = 0;\n                    if (typeof window !== 'undefined' && typeof window.XLATE_COURSEID !== 'undefined') {\n                        courseid = window.XLATE_COURSEID || 0;\n                    } else if (config && config.courseid) {\n                        courseid = config.courseid || 0;\n                    }\n\n                    if (!courseid) {\n                        notification.alert('Please navigate to this page with a valid course filter to autotranslate the course.');\n                        return;\n                    }\n\n                    var selectedTargets = [];\n                    var targetInputs = document.querySelectorAll('#local_xlate_target_container input[type=\"checkbox\"]');\n                    if (targetInputs && targetInputs.length) {\n                        selectedTargets = Array.prototype.filter.call(targetInputs, function (input) {\n                            return !!input.checked;\n                        }).map(function (input) {\n                            return input.value;\n                        });\n                    }\n\n                    if (!selectedTargets.length) {\n                        notification.alert('Select at least one target language before enqueuing autotranslation.');\n                        return;\n                    }\n\n                    // Options for the job (backend will validate course custom fields)\n                    var options = {\n                        batchsize: (config && config.batchsize) ? config.batchsize : 50,\n                        targetlang: selectedTargets\n                    };\n\n                    var call = Ajax.call([{\n                        methodname: 'local_xlate_autotranslate_course_enqueue',\n                        args: {\n                            courseid: courseid,\n                            options: options\n                        }\n                    }])[0];\n\n                    call.then(function (res) {\n                        if (!(res && res.success)) {\n                            notification.alert('Failed to enqueue course autotranslate job.');\n                            return;\n                        }\n                        notification.alert('Course autotranslate job queued. Job id: ' + (res.jobid || 'n/a'));\n                        // Start polling job progress\n                        startCoursePolling(res.jobid);\n                    }).catch(function (err) {\n                        var msg = 'Error enqueuing course job';\n                        if (err && err.message) {\n                            msg += ': ' + err.message;\n                        } else if (err && err.error) {\n                            msg += ': ' + err.error;\n                        }\n                        // Add hint about course settings if it looks like a config error\n                        if (msg.toLowerCase().indexOf('language') !== -1 || msg.toLowerCase().indexOf('configuration') !== -1) {\n                            msg += '\\n\\nPlease configure source and target languages in the course settings (Xlate section).';\n                        }\n                        notification.alert(msg);\n                    });\n                });\n            }\n\n            // If the server detected an active job for this course, resume polling\n            if (config && config.currentjobid) {\n                try {\n                    startCoursePolling(config.currentjobid);\n                } catch (e) {\n                    // ignore any errors starting the resumed poll\n                }\n            }\n\n            /**\n             * Poll course job progress and update the inline progress UI.\n             *\n             * @param {number} jobid Identifies the queued `translate_course_task`.\n             * @returns {void}\n             */\n            function startCoursePolling(jobid) {\n                if (!jobid) { return; }\n\n                var container = document.getElementById('local_xlate_course_progress');\n                var bar = document.getElementById('local_xlate_course_progress_bar');\n                var text = document.getElementById('local_xlate_course_progress_text');\n                if (!container || !bar || !text) {\n                    // Nothing to update on the page; bail out.\n                    return;\n                }\n\n                // Show the inline progress container\n                container.style.display = 'block';\n\n                // Initialize owner/status from server-provided config when available.\n                if (config) {\n                    var ownerEl = document.getElementById('local_xlate_course_job_owner');\n                    var statusEl = document.getElementById('local_xlate_course_job_status');\n                    if (ownerEl && config.currentjobowner) {\n                        ownerEl.textContent = 'Job by ' + config.currentjobowner;\n                    }\n                    if (statusEl && config.currentjobstatus) {\n                        statusEl.textContent = '(' + config.currentjobstatus + ')';\n                    }\n                    // Show languages being translated (targetlang and sourcelang)\n                    var langsEl = document.getElementById('local_xlate_course_job_langs');\n                    if (langsEl) {\n                        var parts = [];\n                        if (config.currentjobsourcelang) {\n                            parts.push(config.currentjobsourcelang + ' →');\n                        }\n                        if (config.currentjobtargetlang) {\n                            if (Array.isArray(config.currentjobtargetlang)) {\n                                parts.push(config.currentjobtargetlang.join(', '));\n                            } else {\n                                parts.push(config.currentjobtargetlang);\n                            }\n                        }\n                        if (parts.length) {\n                            langsEl.textContent = parts.join(' ');\n                        }\n                    }\n                    if (config.currentjobprocessed !== undefined && config.currentjobtotal !== undefined) {\n                        text.textContent = config.currentjobprocessed + ' / ' + config.currentjobtotal;\n                        var pct = config.currentjobtotal > 0\n                            ? Math.round((config.currentjobprocessed / config.currentjobtotal) * 100)\n                            : 0;\n                        bar.style.width = pct + '%';\n                        bar.setAttribute('aria-valuenow', pct);\n                        bar.textContent = pct + '%';\n                    }\n                }\n\n                var tries = 0;\n                var maxTries = 120;\n                var pollInterval = 5000;\n\n                var handle = setInterval(function () {\n                    tries = tries + 1;\n                    Ajax.call([{\n                        methodname: 'local_xlate_autotranslate_course_progress',\n                        args: { jobid: jobid }\n                    }])[0].then(function (res) {\n                        if (!(res && res.success && res.job)) { return; }\n                        var job = res.job;\n                        var total = job.total || 0;\n                        var processed = job.processed || 0;\n                        var percent = total > 0 ? Math.round((processed / total) * 100) : 0;\n\n                        // Update progress bar and numeric text\n                        bar.style.width = percent + '%';\n                        bar.setAttribute('aria-valuenow', percent);\n                        bar.textContent = percent + '%';\n                        text.textContent = processed + ' / ' + total;\n\n                        if (job.status === 'complete' || processed >= total) {\n                            clearInterval(handle);\n                            bar.style.width = '100%';\n                            bar.setAttribute('aria-valuenow', 100);\n                            bar.textContent = '100%';\n                            text.textContent = (processed || total) + ' / ' + total + ' — complete';\n                            notification.alert(\n                                'Course autotranslate complete: ' + processed + ' / ' + total\n                            );\n                        } else if (tries >= maxTries) {\n                            clearInterval(handle);\n                            notification.alert('Course autotranslate polling timed out: ' + processed + ' / ' + total);\n                        }\n                    }).catch(function () {\n                        // ignore transient errors\n                    });\n                }, pollInterval);\n            }\n        }\n    };\n});\n"],"names":["define","Ajax","notification","getString","config","key","fallback","strings","findParentForm","element","closest","node","tagName","toLowerCase","parentNode","deleteTranslation","button","keyid","parseInt","getAttribute","lang","failureMessage","successMessage","disabled","call","methodname","args","then","res","success","form","field","querySelector","value","toggles","querySelectorAll","length","Array","prototype","forEach","toggle","checked","clearTranslationFields","addNotification","message","type","alert","catch","err","msg","error","toggleButtonLoading","loading","isIconButton","classList","contains","dataset","originalHtml","innerHTML","labelText","textContent","trim","originalLabel","label","attachAutoTranslateHandlers","buttons","document","addEventListener","event","preventDefault","targetlang","textarea","statusToggle","reviewedToggle","autosave","courseid","translation","dispatchEvent","Event","bubbles","e","evt","createEvent","initEvent","successKey","saved","requestAutotranslation","init","confirmMessage","confirmTitle","confirmAction","cancelLabel","confirm","attachDeleteHandlers","require","Bootstrap","TooltipCtor","Tooltip","default","getInstance","instance","enable","courseButton","getElementById","currentjobid","parent","body","wrapper","createElement","id","style","margin","insertBefore","firstChild","window","XLATE_COURSEID","selectedTargets","targetInputs","filter","input","map","options","batchsize","jobid","startCoursePolling","indexOf","container","bar","text","display","ownerEl","statusEl","currentjobowner","currentjobstatus","langsEl","parts","currentjobsourcelang","push","currentjobtargetlang","isArray","join","undefined","currentjobprocessed","currentjobtotal","pct","Math","round","width","setAttribute","tries","handle","setInterval","job","total","processed","percent","status","clearInterval"],"mappings":"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"}