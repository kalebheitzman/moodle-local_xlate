{"version":3,"file":"translator.min.js","sources":["../src/translator.js"],"sourcesContent":["// Local/xlate/amd/src/translator.js\ndefine(['core/ajax'], function (Ajax) {\n  var autoDetectEnabled = true;\n  var detectedStrings = new Set();\n  var processedElements = new WeakSet();\n  var lastProcessTime = 0;\n  var processThrottle = 250; // Minimum ms between full DOM scans\n\n  /**\n   * Translate a single element when metadata is present.\n   * @param {Element} node DOM node to translate.\n   * @param {Object<string, string>} map Translation map.\n   * @returns {void}\n   */\n  function translateNode(node, map) {\n    if (node.nodeType !== 1) {\n      return;\n    }\n\n    // First check for explicit data-xlate attribute\n    var key = node.getAttribute && node.getAttribute('data-xlate');\n    if (key && map[key]) {\n      node.textContent = map[key];\n      return;\n    }\n\n    // Then check if text content matches any source text (for auto-detected content)\n    if (node.childNodes.length === 1 && node.childNodes[0].nodeType === 3) {\n      var textContent = node.textContent.trim();\n      if (textContent && window.__XLATE__ && window.__XLATE__.sourceMap) {\n        var translationKey = window.__XLATE__.sourceMap[textContent];\n        if (translationKey && map[translationKey]) {\n          node.textContent = map[translationKey];\n          return;\n        }\n      }\n    }\n\n    // Handle attribute translations\n    ['placeholder', 'title', 'alt', 'aria-label'].forEach(function (attr) {\n      var akey = node.getAttribute && node.getAttribute('data-xlate-' + attr);\n      if (akey && map[akey]) {\n        node.setAttribute(attr, map[akey]);\n      }\n    });\n  }\n\n  /**\n   * Check if element should be ignored for auto-detection\n   * @param {Element} element - Element to check\n   * @returns {boolean} True if should be ignored\n   */\n  function shouldIgnoreElement(element) {\n    var tagName = element.tagName.toLowerCase();\n\n    // Skip script, style, meta tags\n    if (['script', 'style', 'meta', 'link', 'noscript', 'head'].includes(tagName)) {\n      return true;\n    }\n\n    // Skip if marked to ignore\n    if (element.hasAttribute('data-xlate-ignore') ||\n      element.closest('[data-xlate-ignore]')) {\n      return true;\n    }\n\n    // Skip if already has xlate attributes\n    if (element.hasAttribute('data-xlate') ||\n      element.hasAttribute('data-xlate-placeholder') ||\n      element.hasAttribute('data-xlate-title') ||\n      element.hasAttribute('data-xlate-alt')) {\n      return true;\n    }\n\n    // Skip admin paths entirely - these should use Moodle language strings\n    var currentPath = window.location.pathname;\n    var adminPaths = [\n      '/admin/',\n      '/local/xlate/',\n      '/course/modedit.php',\n      '/grade/edit/',\n      '/backup/',\n      '/restore/',\n      '/user/editadvanced.php'\n    ];\n\n    for (var p = 0; p < adminPaths.length; p++) {\n      if (currentPath.includes(adminPaths[p])) {\n        return true;\n      }\n    }\n\n    // Skip admin/navigation elements that shouldn't be translated\n    var adminSelectors = [\n      '.navbar', '.navigation', '.breadcrumb', '.nav',\n      '.admin-menu', '.settings-menu', '.user-menu',\n      '.page-header-headings', '.page-context-header',\n      '.activity-navigation', '.course-content-header',\n      '.block_settings', '.block_navigation',\n      '#page-navbar', '#nav-drawer', '.drawer',\n      '.form-autocomplete-suggestions', '.popover',\n      '.tooltip', '.dropdown-menu'\n    ];\n\n    for (var i = 0; i < adminSelectors.length; i++) {\n      if (element.closest(adminSelectors[i])) {\n        return true;\n      }\n    }\n\n    // Skip if element or parent has admin-related classes\n    var adminClasses = [\n      'editing', 'editor', 'admin-only', 'teacher-only',\n      'form-control', 'btn-secondary', 'btn-outline',\n      'text-muted', 'small', 'sr-only', 'accesshide'\n    ];\n\n    var elementClasses = (element.className || '').split(' ');\n    for (var j = 0; j < adminClasses.length; j++) {\n      if (elementClasses.includes(adminClasses[j])) {\n        return true;\n      }\n    }\n\n    // Skip elements with very short or common admin text\n    var text = element.textContent.trim();\n    if (text.length < 3) {\n      return true;\n    }\n\n    var adminWords = [\n      'edit', 'delete', 'save', 'cancel', 'ok', 'yes', 'no',\n      'settings', 'config', 'admin', 'manage', 'update',\n      'hide', 'show', 'move', 'copy', 'options', 'actions'\n    ];\n\n    var lowerText = text.toLowerCase();\n    if (adminWords.includes(lowerText)) {\n      return true;\n    }\n\n    return false;\n  }  /**\n   * Check if text content is worth translating\n   * @param {string} text - Text to analyze\n   * @returns {boolean} True if should be translated\n   */\n  function isTranslatableText(text) {\n    if (!text || text.length < 3) {\n      return false;\n    }\n\n    // Skip if mostly numbers, symbols, or code\n    var alphaCount = (text.match(/[a-zA-Z]/g) || []).length;\n    if (alphaCount < text.length * 0.5) {\n      return false;\n    }\n\n    // Skip common non-translatable patterns\n    var skipPatterns = [\n      /^\\d+[\\s\\d]*$/, // Just numbers\n      /^[A-Z]{2,}$/, // All caps abbreviations\n      /^[a-z_]+$/, // Variable names\n      /^\\w+\\.\\w+/, // File extensions or dot notation\n      /^https?:/, // URLs\n      /^\\/\\w+/, // Paths\n      /^\\{[^}]+\\}$/, // Template variables\n      /^\\[[^\\]]+\\]$/, // Bracketed content\n      /^<[^>]+>$/ // HTML tags\n    ];\n\n    for (var i = 0; i < skipPatterns.length; i++) {\n      if (skipPatterns[i].test(text.trim())) {\n        return false;\n      }\n    }\n\n    // Skip single common words that don't need translation\n    var commonWords = ['ok', 'id', 'url', 'api', 'css', 'js', 'html', 'php'];\n    if (commonWords.includes(text.toLowerCase().trim())) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Extract clean text from element, handling HTML\n   * @param {Element} element - Element to extract text from\n   * @returns {string} Clean text content\n   */\n  function extractCleanText(element) {\n    var text = '';\n\n    // If element has only text nodes and simple formatting\n    if (element.children.length === 0) {\n      text = element.textContent.trim();\n    } else {\n      // Check if element has only simple formatting (b, i, em, strong, span)\n      var simpleFormatting = true;\n      var children = element.children;\n\n      for (var i = 0; i < children.length; i++) {\n        var tagName = children[i].tagName.toLowerCase();\n        if (!['b', 'i', 'em', 'strong', 'span', 'small'].includes(tagName)) {\n          simpleFormatting = false;\n          break;\n        }\n      }\n\n      if (simpleFormatting) {\n        text = element.textContent.trim();\n      }\n    }\n\n    // Clean up the text\n    return text\n      .replace(/\\s+/g, ' ') // Normalize spaces\n      .replace(/^\\s+|\\s+$/g, '') // Trim\n      .replace(/['\"]/g, \"'\"); // Normalize quotes\n  }\n\n  /**\n   * Generate component name from element context\n   * @param {Element} element - Element to analyze\n   * @returns {string} Component name\n   */\n  function detectComponent(element) {\n    // Check for Moodle-specific containers\n    var container = element.closest('[data-region]');\n    if (container) {\n      var region = container.getAttribute('data-region');\n      if (region) {\n        return 'region_' + region;\n      }\n    }\n\n    // Check for block containers\n    container = element.closest('.block');\n    if (container) {\n      var blockClass = container.className.match(/block_(\\w+)/);\n      if (blockClass) {\n        return 'block_' + blockClass[1];\n      }\n    }\n\n    // Check for course module containers\n    container = element.closest('.activity');\n    if (container) {\n      var activityClass = container.className.match(/modtype_(\\w+)/);\n      if (activityClass) {\n        return 'mod_' + activityClass[1];\n      }\n    }\n\n    // Check for admin pages\n    if (document.body.classList.contains('path-admin')) {\n      return 'admin';\n    }\n\n    // Default to core\n    return 'core';\n  }\n\n  /**\n   * Generate translation key from element content and context\n   * @param {Element} element - Element to generate key for\n   * @param {string} text - Text content\n   * @param {string} type - Type of content (text, placeholder, title, alt)\n   * @returns {string} Generated key\n   */\n  function generateKey(element, text, type) {\n    var tagName = element.tagName.toLowerCase();\n    var keyParts = [];\n\n    // Add context based on element type\n    if (type === 'placeholder') {\n      keyParts.push('Input');\n    } else if (['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].includes(tagName)) {\n      keyParts.push('Heading');\n    } else if (tagName === 'button' || (tagName === 'input' && element.type === 'submit')) {\n      keyParts.push('Button');\n    } else if (tagName === 'a') {\n      keyParts.push('Link');\n    } else if (tagName === 'label') {\n      keyParts.push('Label');\n    } else if (type === 'alt') {\n      keyParts.push('Image');\n    } else if (type === 'title') {\n      keyParts.push('Title');\n    }\n\n    // Clean and format text as key part\n    var cleanText = text\n      .replace(/[^\\w\\s]/g, '') // Remove special chars\n      .replace(/\\s+/g, ' ') // Normalize spaces\n      .trim()\n      .split(' ')\n      .map(function (word) {\n        return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();\n      })\n      .join('');\n\n    if (cleanText) {\n      keyParts.push(cleanText);\n    } else {\n      keyParts.push('Text');\n    }\n\n    // Add type suffix if not text content\n    if (type && type !== 'text') {\n      keyParts.push(type.charAt(0).toUpperCase() + type.slice(1));\n    }\n\n    return keyParts.join('.');\n  }\n\n  /**\n   * Auto-detect and save translatable string\n   * @param {Element} element - Element containing the string\n   * @param {string} text - Text content to save\n   * @param {string} type - Type of content (text, placeholder, title, alt)\n   */\n  function autoDetectString(element, text, type) {\n    if (!autoDetectEnabled || !text || text.length < 2) {\n      return;\n    }\n\n    // Skip if already processed\n    var uniqueId = text + ':' + type + ':' + element.tagName;\n    if (detectedStrings.has(uniqueId)) {\n      return;\n    }\n\n    detectedStrings.add(uniqueId);\n\n    var component = detectComponent(element);\n    var key = generateKey(element, text, type);\n\n    // Save via AJAX\n    Ajax.call([{\n      methodname: 'local_xlate_save_key',\n      args: {\n        component: component,\n        key: key,\n        source: text,\n        lang: M.cfg.language || 'en',\n        translation: text\n      }\n    }])[0].then(function () {\n      // Apply the attribute to the element\n      var attrName = 'data-xlate' + (type !== 'text' ? '-' + type : '');\n      element.setAttribute(attrName, key);\n\n      // Update the global map\n      if (window.__XLATE__ && window.__XLATE__.map) {\n        window.__XLATE__.map[key] = text;\n      }\n\n      return true;\n    }).catch(function () {\n      // Silently fail - don't break the page if auto-detection fails\n      detectedStrings.delete(uniqueId);\n    });\n  }\n\n  /**\n   * Auto-detect translatable content in an element\n   * @param {Element} element - Element to analyze\n   */\n  function autoDetectElement(element) {\n    if (shouldIgnoreElement(element)) {\n      return;\n    }\n\n    // Only auto-detect when viewing in the site's default language\n    // This prevents capturing translations as source text\n    var currentLang = (window.__XLATE__ && window.__XLATE__.lang) || M.cfg.language || 'en';\n    var siteLang = (window.__XLATE__ && window.__XLATE__.siteLang) || 'en';\n\n    if (currentLang !== siteLang) {\n      return;\n    }\n\n    if (processedElements.has(element)) {\n      return;\n    }\n    processedElements.add(element);\n\n    // Check text content with smart extraction\n    var textContent = extractCleanText(element);\n    if (textContent && isTranslatableText(textContent)) {\n      autoDetectString(element, textContent, 'text');\n    }\n\n    // Check attributes\n    if (element.hasAttribute('placeholder')) {\n      var placeholder = element.getAttribute('placeholder').trim();\n      if (placeholder && isTranslatableText(placeholder)) {\n        autoDetectString(element, placeholder, 'placeholder');\n      }\n    }\n\n    if (element.hasAttribute('title')) {\n      var title = element.getAttribute('title').trim();\n      if (title && isTranslatableText(title)) {\n        autoDetectString(element, title, 'title');\n      }\n    }\n\n    if (element.hasAttribute('alt')) {\n      var alt = element.getAttribute('alt').trim();\n      if (alt && isTranslatableText(alt)) {\n        autoDetectString(element, alt, 'alt');\n      }\n    }\n  }\n\n  /**\n   * Walk the DOM depth-first and translate every eligible child.\n   * @param {Element} root Root element to process.\n   * @param {Object<string, string>} map Translation map.\n   * @returns {void}\n   */\n  function walk(root, map) {\n    var stack = [root];\n    while (stack.length) {\n      var el = stack.pop();\n      if (el.nodeType === 1) {\n        if (el.hasAttribute && el.hasAttribute('data-xlate-ignore')) {\n          continue;\n        }\n\n        // Translate existing keys\n        translateNode(el, map);\n\n        // Auto-detect new strings if enabled\n        if (autoDetectEnabled) {\n          autoDetectElement(el);\n        }\n\n        var children = el.children || [];\n        for (var i = 0; i < children.length; i++) {\n          stack.push(children[i]);\n        }\n      }\n    }\n  }\n\n  /**\n   * Entry point: translates current DOM and observes future updates.\n   * @param {Object<string, string>} map Translation map.\n   * @returns {void}\n   */\n  function run(map) {\n    try {\n      walk(document.body, map || {});\n\n      // Process dynamic content with multiple strategies\n      if (autoDetectEnabled) {\n        // Strategy 1: Delayed processing for initial dynamic content\n        setTimeout(function () {\n          walk(document.body, map || {});\n        }, 1000);\n\n        // Strategy 2: Additional delay for slower loading content\n        setTimeout(function () {\n          walk(document.body, map || {});\n        }, 3000);\n      }\n\n      // Strategy 3: Comprehensive MutationObserver\n      var mo = new MutationObserver(function (muts) {\n        muts.forEach(function (m) {\n          (m.addedNodes || []).forEach(function (n) {\n            if (n.nodeType === 1) {\n              walk(n, map || {});\n              // Also process any children that might have been added\n              if (n.querySelectorAll) {\n                var children = n.querySelectorAll('*');\n                for (var i = 0; i < children.length; i++) {\n                  walk(children[i], map || {});\n                }\n              }\n            }\n          });\n        });\n      });\n      mo.observe(document.body, { childList: true, subtree: true });\n\n      // Strategy 4: Listen for common Moodle AJAX events\n      if (typeof window.addEventListener === 'function') {\n        // Listen for RequireJS module loads\n        document.addEventListener('DOMContentLoaded', function () {\n          setTimeout(function () {\n            walk(document.body, map || {});\n          }, 2000);\n        });\n\n        // Listen for focus/click events that might trigger dynamic content (throttled)\n        ['focus', 'click', 'scroll'].forEach(function (eventType) {\n          document.addEventListener(eventType, function () {\n            var now = Date.now();\n            if (now - lastProcessTime > processThrottle) {\n              lastProcessTime = now;\n              setTimeout(function () {\n                walk(document.body, map || {});\n              }, 100);\n            }\n          }, true);\n        });\n      }\n\n    } finally {\n      document.documentElement.classList.remove('xlate-loading');\n    }\n  }\n\n  /**\n   * Initialize the translator with config from Moodle.\n   * @param {Object} config Configuration object with lang, version, bundleurl.\n   * @returns {void}\n   */\n  function init(config) {\n    document.documentElement.classList.add('xlate-loading');\n    var k = 'xlate:' + config.lang + ':' + config.version;\n\n    window.__XLATE__ = { lang: config.lang, siteLang: config.siteLang, map: {}, sourceMap: {} };\n\n    try {\n      var cached = localStorage.getItem(k);\n      if (cached) {\n        var bundleData = JSON.parse(cached);\n        // Handle both old and new bundle formats\n        if (bundleData.translations) {\n          window.__XLATE__.map = bundleData.translations;\n          window.__XLATE__.sourceMap = bundleData.sourceMap || {};\n          run(bundleData.translations);\n        } else {\n          // Old format fallback\n          window.__XLATE__.map = bundleData;\n          run(bundleData);\n        }\n      }\n\n      fetch(config.bundleurl, { credentials: 'same-origin' })\n        .then(function (r) {\n          return r.json();\n        })\n        .then(function (bundleData) {\n          try {\n            localStorage.setItem(k, JSON.stringify(bundleData));\n          } catch (e) {\n            // Storage quota exceeded, ignore\n          }\n          if (!cached) {\n            // Handle both old and new bundle formats\n            if (bundleData.translations) {\n              window.__XLATE__.map = bundleData.translations;\n              window.__XLATE__.sourceMap = bundleData.sourceMap || {};\n              run(bundleData.translations);\n            } else {\n              // Old format fallback\n              window.__XLATE__.map = bundleData;\n              run(bundleData);\n            }\n          }\n\n          return true;\n        })\n        .catch(function () {\n          if (!cached) {\n            run({});\n          }\n        });\n    } catch (e) {\n      fetch(config.bundleurl)\n        .then(function (r) {\n          return r.json();\n        })\n        .then(function (bundle) {\n          window.__XLATE__.map = bundle;\n          run(bundle);\n\n          return true;\n        })\n        .catch(function () {\n          run({});\n        });\n    }\n  }\n\n  /**\n   * Enable or disable automatic string detection\n   * @param {boolean} enabled - Whether to enable auto-detection\n   */\n  function setAutoDetect(enabled) {\n    autoDetectEnabled = enabled;\n  }\n\n  return {\n    run: run,\n    init: init,\n    setAutoDetect: setAutoDetect\n  };\n});"],"names":["define","Ajax","autoDetectEnabled","detectedStrings","Set","processedElements","WeakSet","lastProcessTime","translateNode","node","map","nodeType","key","getAttribute","textContent","childNodes","length","trim","window","__XLATE__","sourceMap","translationKey","forEach","attr","akey","setAttribute","isTranslatableText","text","match","skipPatterns","i","test","includes","toLowerCase","autoDetectString","element","type","uniqueId","tagName","has","add","component","container","closest","region","blockClass","className","activityClass","document","body","classList","contains","detectComponent","keyParts","push","cleanText","replace","split","word","charAt","toUpperCase","slice","join","generateKey","call","methodname","args","source","lang","M","cfg","language","translation","then","attrName","catch","delete","autoDetectElement","hasAttribute","currentPath","location","pathname","adminPaths","p","adminSelectors","adminClasses","elementClasses","j","lowerText","shouldIgnoreElement","siteLang","children","simpleFormatting","extractCleanText","placeholder","title","alt","walk","root","stack","el","pop","run","setTimeout","MutationObserver","muts","m","addedNodes","n","querySelectorAll","observe","childList","subtree","addEventListener","eventType","now","Date","documentElement","remove","init","config","k","version","cached","localStorage","getItem","bundleData","JSON","parse","translations","fetch","bundleurl","credentials","r","json","setItem","stringify","e","bundle","setAutoDetect","enabled"],"mappings":"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"}